(define-param no-struc? true)
(use-output-directory "output")
(set! eps-averaging? true)
(define-param rot 0)
(define rot (* (/ rot 180) pi))

(define-param r 0.090)		; radius of melanosomes
(define-param a 0.190)		; spacing between melanosomes
(define-param cor 0.300)	; keratin cortex thickness
(define-param pad 2.5)
(define-param dpml 1)

;(define mag (/ a .1))
(define mag 1)

; phi =0.6
;(define xx #(0.0821528641957863 -0.331497039461204 0.453752834010417 -0.493756866030159 0.412244378587153 -0.452840043100154 0.18085577090475 0.0187688545476457 -0.327507642182977 0.195865073265446 -0.183000559423012 0.0150347231332664 -0.0294824729384939 -0.173267038108273 -0.429444070667429 -0.26071112810307 0.235948170500195 0.221829685670087 -0.00473033819767776 -0.095094046802091 -0.0179643366731131 -0.112713384072393 0.155891625559602 -0.212335538745586 -0.0950771116622676 -0.490616106549675 -0.408631025021847 -0.431767350532653 0.376238184308854 -0.278686964715514 0.438148374400356 0.254535000600155 0.467698939866844 -0.446198076271962 0.203164666554215 -0.353738640766521 -0.0909462780413451 0.188191827612698 0.307073019213366 0.191926748168431 0.391114711868102 -0.115452619195268 0.0372259791695931 -0.259195557063157 -0.0343136522165683 0.0832809723784007 -0.18190983779832 0.403001924991466 0.298728004030087 -0.205109765022968 0.0654711878255624 -0.07356167877317 -0.178676302613564 0.288863276215403 0.295369766572684 -0.258251385283908 0.0302310802662274 -0.176509349841642 0.189724381710213 0.479602955960025 -0.0863505490409731 -0.15980925211761 -0.00873355544325 -0.0580866245872602 -0.305831552887359 -0.389864385581331 0.280802474137556 -0.385392263632773 -0.23159761756267 -0.321057328667985 -0.235086182794343 0.137115127252033 0.353865001332215 0.486162350581778 0.0157583472864022 -0.441878285231853 0.380039063510594 0.337972140253594 0.124006381900663 0.259086535434592 0.238949710813981 0.071426672776067 0.116364674688569 0.398125428781532 0.105661507206011 -0.431481883705919 0.451130503845218 0.493756866030159 0.09875248208121 0.409590155211152 0.142257751609528 -0.343615237738999 0.284142507729925 -0.287201691851984 0.334046782440546 -0.335428826564418 0.34173685267078 -0.401542141303338 -0.1392996321631 -0.34673345708464))
;(define yy #(-0.312778316411278 -0.186612711573096 0.257743487608271 -0.288094267097919 0.0797010234924191 -0.0313002634092412 -0.107427694979241 0.295999397946978 -0.357741138084868 -0.483464980527111 0.268715477327823 -0.382082519327955 0.206635766374804 0.174122868366429 0.24673191940397 0.335664866874378 0.27755060741471 -0.194413790535043 0.089610604290738 -0.232637066761262 -0.085794562389596 -0.133819787872297 -0.0157474791925784 -0.172272227737812 0.119239299280166 0.335749819855663 -0.115561414119619 -0.374563593247518 0.446527154875682 -0.0878584429333803 -0.208238974034371 -0.012787100299087 -0.389837521811571 -0.203686353538773 0.067101635429915 -0.028392109379041 -0.33499566272739 0.168968553818556 0.0706171577480877 -0.293082422910761 -0.109069284279487 -0.432198119809877 0.0019597321979124 0.014850166007708 -0.491697219804803 -0.090553678572379 -0.0456427892498855 -0.462426130472763 -0.463851411024772 -0.47195061023814 0.17913684080708 0.00124059235726864 -0.287571673186508 -0.287578400488678 0.353154545115068 0.125597870039091 0.418397708977043 0.0638975734975127 0.374912904903576 0.15942803787921 0.290156922932632 0.361894858538018 -0.283037271626574 0.384224955451626 -0.463434047679547 0.332647202082687 -0.109774233300089 -0.280252221107602 -0.369058859961613 0.261657626701964 0.433102555129812 0.253130006746936 -0.0153387644403292 -0.119990025766868 -0.185259559427956 0.0926815368518069 0.170015130538383 0.260645950603247 0.447051022160764 0.444792890625864 -0.384630729702057 -0.469645042185327 -0.199367749554533 0.340392509451998 0.0930339385495174 0.429343268999313 -0.0271834527141558 0.491697219804803 0.347647611078621 -0.302690642505373 -0.388061764382832 0.0662396528816978 0.162667112289922 -0.271988031242001 -0.372343492376637 0.440197569246088 -0.199247963596218 -0.471180042316188 0.456192485219752 0.165478237286569))

; phi =~ 0.6
;(define xx #(-0.178463736501254 -0.0100981135920475 0.431294849274334 0.183455611526423 -0.109165805234002 0.0276759784266351 -0.333338149366651 0.0361507764682753 0.495121208349358 0.237389154907528 0.383165925507181 0.35617490360492 -0.288238483419293 0.125828140492953 0.313024983477616 -0.265311106849875 -0.447797204312706 -0.224713639588754 0.226634508214361 -0.297671073772538 -0.440992356183828 -0.131676345559769 -0.210362898000501 -0.20786559953256 -0.0457749589840746 -0.128541456854814 0.295790462470135 -0.423737603651961 0.152697117909338 -0.304806807965752 0.485829856100798 0.19008920325472 -0.171629497881633 0.157292611177492 -0.346713493151204 0.00726831310448967 -0.0813230085564239 0.391531991974296 -0.137032517869514 0.428244680170765 0.372052386669043 0.461322496271494 -0.495121208349358 0.328033391733445 0.260315180285543 -0.0207515170994558 0.0615116088572312 0.246112604040026 0.234907766606291 -0.453706051621621 -0.352383734356939 0.333409567891592 -0.429023436520702 0.257069240726278 0.142082533830125 0.414315678808058 -0.0207196712552206 -0.394507133601244 0.289950918580588 0.0633122557854195 -0.184002477057081 0.33462596568409 -0.125118435312105 0.0554179178113446 -0.10204375892609 -0.264767493148549 0.323915770458048 -0.304375334742805 -0.466168277551277 -0.0400400647843054 -0.399058248085124 0.166916134233271 -0.017518899612059 0.450365540233569 -0.349347390365256 -0.223247351436274 -0.388685929372451 -0.28216142976465 -0.436936737162436 0.268576137184653 -0.490512375946097 -0.364275877407619 0.072061665389799 0.471308700946899 0.15711245702235 -0.12919131577868 -0.35183360701804 0.0862448373127269 0.415682505705009 0.405913174080542 -0.267466611425947 0.179541022931692 -0.221320480466757 0.397952975273879 0.067715178085013 0.470181410660523 -0.0873799624079578 -0.0333318072981311 0.107543722002288 -0.0217161164004167))
;(define yy #(0.107638888360573 0.273126100163873 -0.33140935520495 0.289292604048706 0.0139118332474434 -0.475101159539019 -0.260664731997603 -0.199353220257452 -0.437040112868824 -0.156013083214596 0.139412236077808 0.339371773225954 0.270237586585553 0.498389694339715 -0.338798021671554 0.167598997976587 0.353107766206472 0.358569581616595 0.479824108664097 -0.17638021764987 0.170013083658133 -0.207552780593842 -0.399659606498556 -0.141621635435919 -0.238515129670771 -0.489469273180297 0.271969029827842 -0.268811403732567 -0.213775346614244 0.441167876593703 0.000402711272065981 -0.427018409940849 -0.0518163415869866 0.400789737905449 -0.0905536728955361 -0.1128111278145 -0.403775601278553 0.240697090205329 -0.329788756692583 -0.498389694339715 -0.409489178245345 -0.245996544439268 0.432502685462039 -0.0231720110834934 0.0500332522819982 0.366512773108116 0.135764527346647 -0.273357687286645 -0.0535264221620486 -0.35601229193359 0.00532374736652352 -0.218425351861826 0.0614494804539506 0.174218630392002 -0.0343422843907603 -0.0633941623884606 0.18321283025254 0.430028983763984 -0.449880695903174 0.0392937544759266 0.257162661723849 0.455896700084587 0.181022787426383 -0.383655629602394 0.297389396000237 -0.0317075416826454 -0.114085513417686 -0.454227007452836 0.264642515038686 0.458192197901316 -0.455342808016287 0.0802559098760576 -0.0208191960409858 0.327607671247237 0.348345045447185 0.484782599622017 -0.184521522348262 -0.342916355165416 -0.0795609689908583 0.389883885746097 -0.167721653794629 0.218732657217558 -0.294850254218989 0.0914674111163485 0.196355126746592 0.407270390131351 0.122385401644661 0.316860415842307 0.411351489672793 -0.155008655595565 0.0691277937332448 -0.33590689533577 -0.273900737828063 0.0373526658271627 0.417804465987706 0.194345250735642 -0.0855328637044884 0.085062222507596 -0.128809507907666 -0.332839704067776))

; phi = 0.75
;(define xx #(0.319880344504253 -0.248182918576651 0.327366997729685 -0.125282116357744 -0.117708062113487 -0.207148619411692 -0.0238516195651973 0.456384384486953 -0.300334596193125 -0.0246713041664837 0.245232826237024 0.0996248882576027 0.280817660783439 0.439511001266126 0.472565662715498 -0.205733648844385 -0.279108600060387 -0.484449033914441 0.484449033914441 0.0175885979366112 -0.372427641775813 -0.129169193290637 -0.148146016571494 0.243585112574446 0.309515844659641 -0.176352278829211 0.055547780096899 -0.425511824493336 -0.0311658630763769 -0.266544391167276 -0.364525798963364 0.43360872439527 -0.109117855085933 -0.436428877231396 0.360546941897331 0.150964184612023 0.0033778893990411 -0.0808607918095297 -0.204123368013537 -0.322212890549722 0.382454179756605 -0.465864293111697 0.303659162845077 0.247044399840191 0.437771325699228 -0.225104800939711 -0.0591434203340768 0.0432428578529909 0.182626570791699 0.280113185648447 0.241371391962655 -0.174792077648667 -0.336429102375327 -0.483483548454057 -0.329307581950606 -0.127603930647122 0.345397040136865 0.143839291731703 0.146187608402877 0.144958749571742 0.426763928078192 -0.0326822664777707 -0.252150439337736 -0.169845897527336 0.0505545762810212 0.426810380611108 -0.306643899932184 0.414225327207847 -0.0308565548904497 -0.241832507958756 -0.300353833921421 0.091604412362753 0.210839824872804 -0.407285339475783 0.241640663114139 -0.388880269504129 0.0826262519775099 -0.423563885929004 0.159423347415758 0.191184599250419 0.045679926977671 0.0694237981679172 0.340926563687226 -0.0999152156634623 0.480303206587288 0.341355898781015 -0.372287507593304 -0.470544229640478 -0.45983089193457 -0.363408767298552 0.233481428355989 -0.0340953822180289 -0.474934966839438 0.156627893291343 0.386792649157714 -0.104698153301789 -0.270661150588055 -0.423537303314724 0.0634494385260752 0.139837813048072))
;(define yy #(0.143418501188206 0.281941914541686 -0.36409456147132 -0.289894354034393 -0.462780963321728 0.187846276560929 -0.490872834516976 0.0216062412901604 0.0131334515996638 0.085351857369272 -0.291105077206808 -0.0636661802400835 -0.0109934135774435 -0.255369119854912 0.207932670550233 -0.0181901130435222 -0.0873898336323937 -0.0629204159864518 0.490872834516976 0.412714296870827 -0.0561393584936391 0.250788161275902 0.347872491720017 0.0807900375214139 -0.105896255349436 0.0756847278648025 0.156941320659387 0.201102843008816 -0.11928054149989 -0.353404316481238 0.283717334521929 0.406594249838411 -0.188752833294586 -0.238325719400121 0.0455074346998224 0.114335347086687 -0.0231814386611569 0.421821300387493 -0.155507168146602 -0.436101372273331 -0.17563621391971 0.400112568969627 0.329556249371203 -0.185961663701038 -0.388040434881274 -0.460720957764215 -0.376866313185882 -0.185676821175152 -0.475595858470288 -0.478696066782179 0.417687019701392 0.449972193673571 -0.275332105506175 -0.323666516333861 -0.174407417385099 -0.0815321612332579 0.239434718855952 0.432024616172875 0.22327119675178 -0.349769661682856 0.300556926583872 -0.255094857528082 0.382631315913214 -0.380469714910186 0.257710837403586 0.118204141279823 0.203430093236919 -0.0729441296682964 0.32455037324387 -0.245674479972944 0.46836246419368 0.348182164216959 -0.0833155487819067 0.484363925557369 0.202692026521829 -0.357469677990013 -0.48508172328487 -0.139242772183225 0.013900235053984 0.322301171890167 -0.392041519843514 0.0543614057602383 0.438332723039998 0.011899914310961 -0.164031506037028 -0.266589232283699 0.117462532280389 0.293405959329215 -0.428020886643081 0.382403082123836 -0.390625051970671 0.20934960409876 0.114572157562734 -0.250396566630369 -0.47320481879167 0.142049102128565 0.110795426826145 0.0312172658684268 -0.283331994126201 -0.153565240237143))

; phi = 0.77
;(define xx #(0.339972898841982 -0.184718262296517 0.396724355842249 -0.247434268118932 -0.0794197738651222 0.475446193341507 0.0649167006427627 -0.317968474273221 -0.162919088405153 -0.265229391387416 0.275710311683356 0.442473924527503 -0.408461352855486 0.495468148810107 -0.0374065986324878 -0.457142634946331 -0.343736515772529 0.246972870153238 0.249343050846219 -0.353150596789278 0.26806294253727 0.0886806011987309 0.232387982854059 0.216498665970847 -0.371133581536239 0.13593060994701 0.280826330217521 -0.331616057457019 -0.0556850998364341 -0.42769496486315 0.458571675102652 0.0383790918864824 0.41742622785464 -0.474409958596386 0.0872027618029397 0.136757637801706 0.164000067950622 -0.174848638048979 -0.264139294342312 0.183604285222414 -0.0598399025884602 -0.402178446837618 -0.334799224838629 -0.361476849538836 -0.0076887129287847 -0.0967007445421374 0.0157169003761711 0.356007207613788 -0.249914172185527 -0.290658013345956 -0.415741207707406 0.358045582525477 0.479324704074958 0.376886655597385 -0.176394732063109 -0.0133911767619069 -0.35890019610548 0.0368801383646331 0.275761772282428 -0.142370450231316 -0.460511598122672 -0.000942860854864558 0.227920713926204 -0.292306271435283 -0.468215505572184 -0.495468148810107 0.0211946179529982 0.158639120183295 0.257678757690474 -0.0315851411196777 -0.193258172422042 0.331691813845167 -0.100855807991487 0.17612581873588 0.0937654813242413 -0.442371371483441 -0.192725704256446 0.164634233147562 0.0856501946055381 -0.123827845007558 0.1847347117459 0.463793803208078 -0.152119876348896 -0.384291575875975 -0.264353559627645 -0.0153539807805623 0.472870523839997 0.315845815672481 0.385531093311928 0.060557818992495 -0.0830604854554227 0.414591313631101 0.367034612936687 -0.124199645697016 0.376028075414673 0.13612571701098 0.0810009739555482 -0.246949324716838 0.428968282363144 -0.194315955066075))
;(define yy #(-0.385052689330444 -0.175877071296123 0.441507917271647 -0.469072286191784 0.483761425826478 0.0121413638843137 -0.28903180755677 0.46138865508539 0.214356390578849 -0.371628694483117 -0.232476027979694 -0.366623310523733 -0.252358123542878 0.433373114711855 0.3294839217968 0.253647743789843 0.365746326212334 0.46490577013917 -0.428641915801146 -0.445963464465756 0.124527855472058 0.0741678398836647 0.314057418301651 -0.0490469749890682 0.073088940145525 -0.385158652352815 0.026276564216328 -0.185425750072107 -0.419333609658788 -0.00862384810844435 0.341415547293908 0.265694998231899 0.0924477953170552 -0.442909775861886 0.351877481044042 0.253956826027988 -0.290098343810735 -0.0698062864920633 -0.112707684732227 0.0457768989630181 0.23295510574984 -0.11591762896762 -0.0432287304169153 -0.347266004659484 0.0971278919362807 0.14067951947675 -0.099094071366547 0.170155987019446 0.0174493971234147 0.130992908666735 0.477267081541583 0.350318618443458 0.177657602368684 0.00207072301376426 0.461892396629723 -0.193797469692386 0.26779179357108 -0.38404584915826 -0.128809397636245 0.0240601463152331 -0.344832604286164 0.42158003918023 0.215093040075028 -0.27634629291084 0.0936077686368581 -0.082595330865702 -0.48186089046694 0.14428637652369 -0.329872851870608 -0.311871977404595 -0.276000075034207 -0.483761425826478 -0.240333169899976 0.39558507862887 0.450713663167117 0.355940926319378 0.116149410246235 -0.479992841946577 -0.192158525139338 0.377940538218239 -0.19323783839545 -0.172882499285498 -0.442072495810459 0.172046280556047 0.238254321423643 -0.00163780479810977 -0.271518465977602 0.260709692432497 -0.0967025593827373 0.169139763192332 -0.107080987857219 0.252665972665982 -0.194076762427169 -0.347018217048123 -0.292779821250949 -0.106931754001627 -0.024591054528228 0.392310822448369 -0.464797169163015 0.308312681678869))

; from actual TEM data
(define xx #(0.760064832795 -1.107448540205 2.105475067795 1.455659631795 0.942710358794999 -1.762060338805 -1.985725567805 0.172084220795 0.652303186795 2.055269828795 -1.213540847105 1.431428532795 0.819377340795 1.624262995795 -2.094174706635 -1.363887866705 1.026715862795 1.945150346795 1.144748242795 1.307008658795 1.487683917795 -0.112096745205001 -1.496731640505 -0.853065220205 0.907241396794999 1.658603215795 1.201263344795 0.0765991587949997 1.865224963795 1.374113683795 -0.403865037205001 1.039743105795 1.819865279795 -2.105475067795 1.210787097795 -1.974745644005 0.0624500357949995 -1.547343189505 0.656839261795 1.566946016795 -1.206153076805 -1.841840604405 1.327853514795 -1.353618965005 1.473483650795 0.725364839795 1.660787987795 0.184275341795 0.964237775795 1.149357727795 -0.960681781205001 1.311232393795 0.109391479795 1.559392566795 0.644098417795 -0.460013070205 -0.756141527205 -1.330590782905 0.781764238795 0.560526135795 0.00880002579499983 1.471805967795 1.029506083795 -0.113378175205 -1.457821724405 0.0547505027949997 0.472220879795 0.887533704795 1.207151995795 1.395001788795 0.656233097794999 -1.432645222205 0.812328089795 1.334323655795 -0.226844291205 -1.763929789405 1.213552693795 0.659618481795 0.0911301277949996 -0.0908130232050004 -1.650074974205 -0.276307165205 -2.017588262305 -1.839808975705 1.136745797795 0.0520480367949996 0.753908778795 0.213584294795 -0.329017857205001 0.582983729795 -0.110503571205 -1.608570423105 1.087748341795 -0.878714896205 0.0895136457949999 0.309139467795 0.728634874795 -0.264960172205001 0.559233046795 0.960166811795 -0.654686119205 -0.946861000205 0.413459215795 -0.0344927092050002 0.186116048795 -0.778782238205 -0.549899817205 0.822659425795 0.593330289795 0.384999459795 -0.104335421205001 -1.624458329905 -0.486338621205 0.183266337795 -1.099422855205 0.535619181795 0.718642075795 -0.276991688205001 -0.793815409205 0.367899450795 -0.0257532072050002 0.160105300795 -0.554513982205 -1.281813543105 -1.092483846205 -0.192537777205001 -0.362018815205 0.635655779795 -0.908526822205 -1.443449780805 0.315207015795 0.0215174627949994 -0.759455290205 0.501196862795 -0.547169414205001 -1.120556981205 -0.953126796205001 -0.373862407205001 0.102250120795 0.363833272795 -0.862823480205001 -0.183558104205001 0.232161004795 -0.627499758205 0.021429220795 -1.710536755005 -1.337346154605 -1.893691129405 -1.167079744105 -1.515436878705 0.141536947795 -0.386971437205 -0.175684326205001 -1.374035193905 0.00814413479499976 -0.730779366205001 -1.904244902405 -0.516560186205 -0.308311787205001 -0.891194233205 -0.110021839205001 -0.592069443205001 -1.417635744905 -1.865742914405 -1.690799478805 -0.464833039205 -0.718472787205001 -0.239727625205 -0.943574180205001 -1.545920661305))
(define yy #(-2.2031233045 -2.1797616335 -2.2011493836 -2.185440127 -2.1080073411 -2.0787411614 -2.0424425368 -2.0227524686 -2.0099889636 -2.01441024 -1.9908226871 -1.9640852216 -1.9148429741 -1.9292625817 -1.9085516979 -1.8489351328 -1.8870628541 -1.835851773 -1.8351873622 -1.8188867093 -1.7789102596 -1.7210330737 -1.7135955767 -1.6914289746 -1.697154357 -1.6921397738 -1.6482158222 -1.6084812255 -1.6316273675 -1.5817143135 -1.5134922463 -1.4981284808 -1.4364063514 -1.4270455926 -1.4140598036 -1.3446375408 -1.3470214576 -1.2836238405 -1.2481848675 -1.2365884395 -1.2221486255 -1.1787046005 -1.1821755585 -1.0990882855 -1.0523614545 -1.0450487885 -1.0389984515 -1.0229691625 -0.9407207205 -0.8912735285 -0.9210031495 -0.8702923915 -0.8739654975 -0.8587380575 -0.8638022035 -0.8366366935 -0.8057092645 -0.7846282575 -0.7476294135 -0.6864814715 -0.6999372365 -0.6665512405 -0.6372746565 -0.5713550355 -0.5500577565 -0.5276212745 -0.5053618595 -0.4989342485 -0.5028280465 -0.4881746355 -0.4323984085 -0.3449146685 -0.3252420075 -0.2995822895 -0.2669498135 -0.2191315735 -0.1391893435 -0.0918416324999995 -0.1168793625 -0.0827775934999999 -0.0362137505 -0.0597511085 -0.0342148725000002 -0.0103299815 0.0545881425000001 0.0776969945000001 0.1124286675 0.1054035765 0.1271174645 0.1628907935 0.2042756955 0.2056059035 0.2463504895 0.2903662275 0.3073693185 0.2979621505 0.3463610365 0.3574072495 0.3669534895 0.3788763335 0.3853469685 0.4720868215 0.5000383635 0.4963352355 0.5332809625 0.5333197105 0.5583860125 0.633413489500001 0.6182582685 0.6971989675 0.7326455625 0.7489312865 0.7530541155 0.7334917705 0.7931500755 0.8148438975 0.8276417405 0.8492104785 0.8889013845 0.8990434335 0.9120864805 0.9126136495 0.9557174025 0.9960372895 0.9912378835 1.0036498615 1.0522240995 1.0291988915 1.0459592825 1.0700421225 1.1021219095 1.1468558515 1.2018669565 1.1902256495 1.2079713035 1.1894632195 1.2566824325 1.3706100605 1.3455515985 1.3503210575 1.4321581355 1.4729206055 1.4902058675 1.5316330055 1.5156379635 1.5572136695 1.5702847365 1.5857186205 1.6079599255 1.6557873495 1.6520769825 1.6695010595 1.7191169885 1.7761845635 1.7921562595 1.8343787345 1.8234303865 1.8124159865 1.9063886505 1.9420691785 1.9573074925 1.9659695515 1.9915493845 2.0241658745 2.0594973335 2.0682035635 2.1389401085 2.1309844065 2.1255125035 2.2031233045))
(define rr #(0.106134591606735 0.104510152441772 0.100248760857013 0.0954849449740471 0.109068202739637 0.105211734993789 0.0966868446470479 0.0950989280076085 0.10736069536759 0.090376027805487 0.103192191098899 0.0982839220825727 0.0977165338052504 0.101140784686014 0.077482518060125 0.107647160821761 0.0741425305589283 0.0997097161193854 0.0794772603554507 0.0862991216737774 0.0903854927608457 0.0937946523822202 0.0932825092719431 0.099167741330874 0.106665227681151 0.0996839746028583 0.0963678037760988 0.115335297689226 0.094945883769338 0.0934748917734093 0.102284605086645 0.101411079575826 0.0873533311984367 0.0602538402743124 0.0927306457656475 0.0983709221165587 0.0698900093161181 0.0941405913245589 0.106368075912726 0.0917662208392484 0.0992367276048374 0.117539356173411 0.0982578070543567 0.0927398703937721 0.0985273286009545 0.0853923105179852 0.0882302968429187 0.0844352497491001 0.110695304790086 0.10888765860561 0.10081038295199 0.0911113408804453 0.0922682381444812 0.100878245900573 0.0950539405765583 0.11019184244557 0.0938584737827562 0.0961812078768418 0.088201205140222 0.0866848511427525 0.0783935273217979 0.0931448499321186 0.0956818398089046 0.0970401043048741 0.095422211415215 0.0967752804487345 0.103614111477837 0.0962701081850446 0.0968106321560602 0.0946932716904079 0.0886365781704557 0.101630164841839 0.0904233426221492 0.0897586655475536 0.0878805607504632 0.111365607869354 0.0933100167660053 0.10545537499241 0.0851816754919718 0.101368893511127 0.109857514686292 0.0863585768020149 0.0950089318436296 0.0905840281419314 0.101402643757507 0.0935480762705308 0.0888101297879116 0.0719407119561907 0.0965008656532259 0.0909045470883032 0.100385200189567 0.10099689630601 0.0864080915164605 0.101427949091939 0.10669730261639 0.0915235267134787 0.103275056451708 0.11273978992343 0.0884046460373257 0.0955923924331222 0.0867341795759064 0.103042865564756 0.10291826211418 0.101495399101947 0.101411079575826 0.0906501099819798 0.0816539587209259 0.10528488618415 0.090404419663533 0.0896251386064421 0.102851745204218 0.0969960172091433 0.089739602431787 0.0841510918460698 0.0972338500524427 0.0913551300086342 0.103976745488507 0.0881332871443061 0.0902718479218725 0.0965806147910187 0.0995723511909426 0.0909986025312558 0.10029141808964 0.0919245590175626 0.0969783767557183 0.0867933366998455 0.110323739081872 0.0962701081850446 0.0869213723224825 0.100708502801579 0.0762920345249501 0.092231145395387 0.109537786725909 0.104877844982462 0.107726599366707 0.0967664405121506 0.0883175144723783 0.124604968253573 0.103067768175111 0.100487408124057 0.0985012780894508 0.100844320134808 0.0889833428959656 0.117495680193171 0.0902907986469771 0.092231145395387 0.0884336708328337 0.0965540390693684 0.0963855559764588 0.0953773764700286 0.0859912819276243 0.089634682851822 0.0987874557604709 0.104206855550338 0.104616507465759 0.115238835550124 0.103192191098899 0.0799601483138381 0.117655746211462 0.0783826143313288 0.095215795865551 0.0872847534757363 0.100767945408559 0.0933924906534856 0.0904706326938582 0.0759999420400728 0.107575615970335 0.109943137156065 0.0938767005017258 0.0945124211264092))

(define sx0 4.2) ; width of original image
(define sy0 4.4) ; height of original image
(define sx (+ sx0 (* 2 dpml)))
(define sy (+ (* pad 2) sy0 (* 2 dpml)))

(define fcen 2.4)
(define df 4)
(define nfreq 100)

(set! geometry-lattice (make lattice (size sx sy no-size)))

; material properties
(define-param n1 1)
(define-param n2 2)
(define-param n3 1)
(define eps1 (* n1 n1)) ; permittivity of material 1 (low index)
(define eps2 (* n2 n2)) ; permittivity of material 2 (high index)
(define eps3 (* n3 n3))	; permittivity of material 3 (b/w melanosomes)
(define-param k1 0)	; extinction coeff mat 1
(define-param k2 0.01)	; extinction coeff mat 2
(define-param k3 0.01)	; extinction coeff of material b/w mels

(define mat1 (make medium (epsilon eps1) (D-conductivity (/ (* 2 pi fcen (* 2 (sqrt eps1) k1)) eps1))))
(define mat2 (make medium (epsilon eps2) (D-conductivity (/ (* 2 pi fcen (* 2 (sqrt eps2) k2)) eps2))))
(define mat3 (make medium (epsilon eps3) (D-conductivity (/ (* 2 pi fcen (* 2 (sqrt eps3) k3)) eps3))))

(set! default-material mat1) ; changed from mat3

; I think this worked at creating a geometry with cylinders at the (x,y)
; coordinates specified by the vectors xx and yy
(define (doit x x-max dx)
	(if (<= x x-max)
 	  (begin
		(set! geometry (append geometry
			(list 
			 ;(make block
	  	 		;(center 0 (- (* 0.5 sy) (- (/ (+ dpml pad) 2) cor)))
	  	   		;(size sx (+ dpml pad) infinity) (material mat1))
			 ;(make block
	  	 		;(center 0 (- (* 0.5 sy) (- (+ dpml pad) r (/ cor 2))))
	  	   		;(size sx cor) (material mat1))
			 (make cylinder
				(center 
					(+ (* (vector-ref xx x) (cos rot) mag) (* (vector-ref yy x) (sin rot) mag))
					(+ (* (* (vector-ref xx x) -1) (sin rot) mag) (* (vector-ref yy x) (cos rot) mag)))
				 (radius (vector-ref rr x)) (height infinity)
  				 (material mat2)))))
		(doit (+ x dx) x-max dx))))

; define geometry
(if no-struc?
	(set! geometry (list 
		(make block (center 0 0) (size sx sy infinity) (material mat1))))
	(doit 0 169 1)) ; do loop from a to b in steps of dx

; excite sources
(set! sources (list
	 (make source
	  (src (make gaussian-src (frequency fcen) (fwidth df)))
	    (component Ez)
		(center 0 (- (* 0.5 sy) dpml 1))
		(size sx 0))))

(set! pml-layers (list (make pml (thickness 1.0))))
;(set! pml-layers (list (make pml (direction Y) (thickness dpml)))) ; only on Y extremes

(define-param res 50)
(set! resolution res)
(set! k-point (vector3 0 0 0))
;(set! ensure-periodicity true)

; define flux regions (planes)
(define refl ; reflected flux
	(add-flux fcen df nfreq
	 (make flux-region
	  (center 0 (- (* 0.5 sy) dpml 2)) (size (* sx 2) 0))))

(define trans ; transmitted flux
	(add-flux fcen df nfreq
	 (make flux-region
	 (center 0 (+ (* -0.5 sy) dpml 1)) (size (* sx 2) 0)))) ; changed from (* sy2)

(if (not no-struc?) (load-minus-flux "refl-flux" refl))

(run-sources+
	(stop-when-fields-decayed 50 Ez
		(vector3 0 (- (* 0.5 sy) dpml 1))
		1e-2)
	(at-beginning output-epsilon)
	(at-end (output-png Ez "-Zc bluered")))

;(run-until 10
;	(at-beginning output-epsilon)
;	(at-every 1 (output-png Ez "-Zc bluered"))
;	(at-end output-efield-z))

(if no-struc? (save-flux "refl-flux" refl))
(display-fluxes trans refl) ; print out the flux spectrum