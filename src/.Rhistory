setwd("~/Documents/School/PhD/Projects/Polyplectron")
Load packages
require(pavo)
require(gridExtra)
require(akima)
require(spatstat)
require(hyperSpec)
require(nlme)
require(plotrix)
source('~/R/src/photonics/runMeep.R')
source('~/R/src/color analysis/Thin films/srefl_2layers.R', chdir = TRUE)
source("~/R/src/color analysis/peaks.R")
source("~/Desktop/rugate2.R")
Spectral data
specs_oil <- getspec("data/spectra/2011-12-13", "ttt", lim=c(300, 850))
specs_btpi <- getspec("data/spectra/2013-02-04", "ttt", lim=c(250, 850))
specs_micro <- getspec("data/spectra/2013-07-05 barbules", lim=c(300, 800))
specs_angle <- getspec("data/spectra/2011-11-28", "ttt", lim=c(300, 850))
specs_mus <- getspec("data/spectra/2012-05-10", "ttt", lim=c(220, 950))
specs_pobi_specular <- getspec("data/spectra/2013-06-24 specular, pol", "ttt", lim=c(300, 850))
specs_pafa_specular <- getspec("data/spectra/2013-07-11 specular btpi/specular BTPI", "ttt", lim=c(280, 850))
specs_pink <- getspec("data/spectra/2012-02-16", "txt", lim=c(351, 849))
specs_pol2 <- getspec("data/spectra/2013-06-13", "txt", lim=c(350, 750))
btpi_oil <- getspec("data/spectra/2013-07-25 pigeon oil", "txt", lim=c(350, 750))
colordat <- read.csv("/Users/chad/Documents/School/PhD/Projects/Polyplectron/data/color data.csv")
Morphology data
btpi_morph <- read.csv("data/btpi_measures_upperlayer.csv", row.names=1)
pobi_morph <- read.csv("data/polyplec_upper_barbule.csv", row.names=1)
Color palettes
pal <- brewer.pal(7, "Set1")
pal2 <- brewer.pal(11, "Spectral")
jet.colors <- colorRampPalette(rev(pal2))
pal3 <- rgb(c(244,230,188,150,123,107,100,95,87,88)/256,c(204,165,104,93,91,92,90,89,86,88)/256,c(53,60,97,142,151,167,146,120,106,87)/256)
jet.colors3 <- colorRampPalette(rev(pal3))
Load simulation results
load("output/graded_sims.Rdata")
refls <- sapply(lapply(sims, "[[", "full"), "[[", "model.s")
wl <- sims[[1]]$full[,1]
specs_full <- as.rspec(cbind(wl, refls))
refls <- sapply(lapply(sims, "[[", "top"), "[[", 2)*100
wl <- sims[[1]]$top[,1]
specs_top <- as.rspec(cbind(wl, refls))
refls <- sapply(lapply(sims, "[[", "mels"), "[[", "model.s")
wl <- sims[[1]]$mels[,1]
specs_bot <- as.rspec(cbind(wl, refls))
refls <- sapply(lapply(sims, "[[", "ker"), "[[", "model.s")
wl <- sims[[1]]$ker$wavelength
specs_ker <- as.rspec(cbind(wl, refls))
refls <- sapply(lapply(sims, "[[", "film2"), "[[", "refl")*100
specs_2layer <- as.rspec(cbind(wl, refls))
refls <- sapply(lapply(sims, "[[", "film3"), "[[", "refl")*100
wl <- sims[[1]]$film2[,1]
specs_2layer_mel <- as.rspec(cbind(wl, refls))
phi <- .75
n_mel <- 2*pi*(phi/2)^2/phi + 1*(1-(pi*(phi/2)^2/phi))
mod1 <- readRDS("output/graded_sims_antirefl1.RDS")
mod2 <- readRDS("output/graded_sims_antirefl2.RDS")
mod3 <- readRDS("output/graded_sims_antirefl3.RDS")
mod1_abs <- readRDS(file="output/graded_sims_antirefl1_abs.RDS")
gradient <- c(0,0.06439286,0.1285176,0.1921084,0.2549013,0.3166358,0.3770561,0.4359114,0.4929575,0.547958,0.6006845,0.6509185,0.6984515,0.7430863,0.7846379,0.8229337,0.8578149,0.8891276,0.9167458,0.9405593,0.9604693,0.9763934,0.9882655,0.9960364,0.9996738,0.9996738,0.9960364,0.9882655,0.9763934,0.9604693,0.9405593,0.9167458,0.8891276,0.8578149,0.8229337,0.7846379,0.7430863,0.6984515,0.6509185,0.6006845,0.547958,0.4929575,0.4359114,0.3770561,0.3166358,0.2549013,0.1921084,0.1285176,0.06439286,0)
abline(v=490, lty=3, col="white")
abline(v=490, lty=3, col=pal[3], lwd=2)
plot(model.s~wavelength, mod3, type='l', ylim=c(0.01, 11), ylab="Reflectance (%)", xaxs="i", xaxt="n")
head(od1)
head(mod3)
2*2*217/2
abline(v=434)
plot(1-mod3$model.s)
mod3$wavelength[peaks(1-mod3$model.s)]
abline(v=427.27)
specs_2layer_mel[,32]
head(specs_2layer_mel[,32])
head(specs_2layer_mel)
specs_2layer_mel[,1]
plot(specs_2layer_mel, 32:41, type="h", zlim=c(0, 25), varying=simdat$cor[1:10], useRaster=TRUE, xlim=c(300, 1000), ylab="Cortext thickness (nm)", col=jet.colors3(100))
abline(v=428)
plot(x=as.numeric(specs_full[191, 32:41]), y=simdat$cor[1:10], xlim=c(0, 25), type='l', xlab="Reflectance (%)", col=pal[3], lwd=2, yaxt="n")
plot(model.s~wavelength, mod1, type='l', ylim=c(0.01, 11), ylab="Reflectance (%)", xaxs="i", xaxt="n")
legend("topleft", bty="n", lty=1, col=pal[c(4,3)], legend=c("350 nm", "490 nm"), lwd=2)
lines(x=as.numeric(specs_2layer_mel[228, 32:41]), y=simdat$cor[1:10], col=pal[4], lwd=2, type='l')
plot(x=as.numeric(specs_full[191, 32:41]), y=simdat$cor[1:10], xlim=c(0, 15), type='l', xlab="Reflectance (%)", col=pal[3], lwd=2, yaxt="n")
abline(v=dip1, lty=3, col=pal[3], lwd=2)
lines(model.s~wavelength, mod3)
lines(model.s~wavelength, mod2)
legend("topleft", lty=1:3, legend=c("graded layer","uniform layer"), bty="n")
abline(h=((1.56-1)/(1.56+1))^2*100)
lines(x=as.numeric(specs_full[51, 32:41]), y=simdat$cor[1:10], col=pal[4], lwd=2, type='l')
lines(as.numeric(specs_full[401, 32:41])~simdat$cor[1:10], col=pal[1], lwd=2, type='l')
legend("topleft", bty="n", lty=c(1,2), legend=c("graded", "continuous"), lwd=2)
abline(v=4.8, lty=3)
gradient.rect(xleft=x-(sx/2), ybottom=y1-(sy/2), xright=x+(sx/2), ytop=y1[1]+(sy/2), col=grey(1-gradient), nslices=50, gradient="y", border=NA)
abline(v=dip1, lty=3, lwd=2)
abline(v=dip1, lty=3, col="white", lwd=2)
plot(x=as.numeric(specs_full[191, 32:41]), y=simdat$cor[1:10], xlim=c(0, 15), type='l', xlab="Reflectance (%)", lwd=2, yaxt="n")
lines(x=as.numeric(specs_2layer_mel[228, 32:41]), y=simdat$cor[1:10], lwd=2, lty=2)
plot(x=as.numeric(specs_full[191, 32:41]), y=simdat$cor[1:10], xlim=c(0, 15), type='l', xlab="Reflectance (%)", yaxt="n")
plot(x=as.numeric(specs_full[191, 32:41]), y=simdat$cor[1:10], xlim=c(0, 15), type='l', xlab="Reflectance (%)", yaxt="n", yaxs="i")
grid()
plot(x=as.numeric(specs_full[191, 32:41]), y=simdat$cor[1:10], xlim=c(0, 15), type='l', xlab="Reflectance (%)", yaxs="i")
?plot
Plot effects of graded model
layout(matrix(c(1,2,3,4), nrow=2), heights=c(.3, 1), widths=c(1,.3))
par(mar=c(0,4,0,0))
plot(model.s~wavelength, mod1, type='l', ylim=c(0, 15), ylab="Reflectance (%)", xaxs="i", xaxt="n")
lines(model.s~wavelength, mod3, lty=2)
dip1 <- 490
dip3 <- mod3$wavelength[peaks(1-mod3$model.s)]
abline(v=dip1, lty=3)
abline(v=dip3, lty=3, col=pal[3], lwd=2)
abline(v=350, lty=3, col=pal[4], lwd=2)
par(mar=c(4,4,0,0))
plot(specs_full, 32:41, type="h", zlim=c(0, 25), varying=simdat$cor[1:10], useRaster=TRUE, xlim=c(300, 1000), ylab="Cortext thickness (nm)", col=jet.colors3(100))
d <- unique(simdat$d)[4]
lines(x=(simdat$cor[1:10]*2*1.56 + d*2*n_mel)/1.5, y=simdat$cor[1:10], lty=2)
lines(x=(simdat$cor[1:10]*2*1.56 + d*2*n_mel)/2.5, y=simdat$cor[1:10], lty=2)
lines(x=(simdat$cor[1:10]*2*1.56 + d*2*n_mel)/3.5, y=simdat$cor[1:10], lty=2)
lines(x=(simdat$cor[1:10]*2*1.56 + d*2*n_mel)/4.5, y=simdat$cor[1:10], lty=2)
lines(x=(simdat$cor[1:10]*2*1.56 + d*2*n_mel)/5.5, y=simdat$cor[1:10], lty=2)
abline(v=dip1, lty=3, col="white")
plot(NA, type='n')
setwd("~/MEEP/src")
pal <- rgb(c(244,230,188,150,123,107,100,95,87,88)/256,c(204,165,104,93,91,92,90,89,86,88)/256,c(53,60,97,142,151,167,146,120,106,87)/256)
jet.colors <- colorRampPalette(rev(pal))
blockcen <- c(-.568, 0)
blocksize <- 3.248 # cortex thickness
cylcen <- c(1.124, 0)
cylsize <- .136 # mel diameter
load(file="~/Documents/School/PhD/Projects/Polyplectron/output/fields.Rdata")
image(x=x, y=y, z=as.matrix(field_norod)^2, col=grey.colors(100), asp=1, xlim=c(.8, 1.4), ylim=c(-.25, .25))
system("meep diam=.150 cor=.250 fcen=2.857 df=.01 res=120 mcc_reson.ctl")
sx <- 4.384
sy <- 2.136
x <- seq(-sx/2, sx/2, length=526)
y <- seq(-sy/2, sy/2, length=256)
cylsize <- .150 # mel diameter
image(x=x, y=y, z=as.matrix(field_rod)^2, col=jet.colors(100), asp=1, xlim=c(.8, 1.4), ylim=c(-.25, .25), useRaster=TRUE)
blockcen <- c(.5, 0)
blocksize <- .250 # cortex thickness
cylcen <- c(1.125, 0)
cylsize <- 1 # mel diameter
sx <- 5.25
sy <- 1
system ("h5totxt -o output/test.txt output/hz-000000840.h5")
x <- seq(-sx/2, sx/2, length=630)
y <- seq(-sy/2, sy/2, length=120)
system ("h5totxt -o output/test.txt output/hz-000000798.h5")
system ("h5totxt -o output/test.txt output/hz-000000756.h5")
system ("h5totxt -o output/test.txt output/hz-000000420.h5")
image(x=x, y=y, z=as.matrix(field_rod)^2, col=heat.colors(100), asp=1, useRaster=TRUE)
system("meep diam=1 cor=.250 fcen=2.857 df=.01 res=120 mcc_reson.ctl")
250*2*1.56/.5
250*2*1.56/1.5
1/520
1/.520
system("meep diam=1 cor=.250 fcen=1.923 df=.01 res=120 mcc_reson.ctl")
system ("h5totxt -o output/test.txt output/hz-000002480.h5")
system ("h5totxt -o output/test.txt output/hz-000000620.h5")
system ("h5totxt -o output/test.txt output/hz-000001488.h5")
system ("h5totxt -o output/test.txt output/hz-000001798.h5")
field_rod <- read.csv("output/test.txt", head=FALSE)
image(x=x, y=y, z=as.matrix(field_rod)^2, col=grey.colors(100), asp=1, useRaster=TRUE)
system("meep diam=.15 cor=.250 fcen=1.923 df=.01 res=120 mcc_reson.ctl")
cylsize <- .15 # mel diameter
system("h5ls output/hz-000000840.h5")  # dimensions of dataset
system("h5ls output/hz-000001860.h5")  # dimensions of dataset
sx <- 4.4
sy <- .15
x <- seq(-sx/2, sx/2, length=528)
y <- seq(-sy/2, sy/2, length=18)
system ("h5totxt -o output/test.txt output/hz-000001860.h5")
field_rod2 <- read.csv("output/test.txt", head=FALSE)
image(x=x, y=y, z=as.matrix(field_rod)^2, col=jet.colors(100), asp=1, useRaster=TRUE)
blockcen <- c(.925, 0)
image(x=x, y=y, z=as.matrix(field_rod2)^2, col=jet.colors(100), asp=1, useRaster=TRUE)
rect(xleft=blockcen[1]-(blocksize/2), ybottom=-sy/2, xright=blockcen[1]+(blocksize/2), ytop=sy/2)
draw.circle(x=cylcen[1], y=0, radius=cylsize/2)
system("meep diam=.5 cor=.250 fcen=1.923 df=.01 res=120 mcc_reson.ctl")
HR(d=500, cor=150)
150*2*1.56/1.5
150*2*1.56/2.5
150*2*1.56/.5
HR(d=500, cor=250)
HR(d=600, cor=250)
HR(d=700, cor=250)
HR(d=800, cor=250)
HR(d=900, cor=250)
HR(d=1000, cor=250)
system("meep diam=2 cor=.250 fcen=1.923 df=.01 res=120 mcc_reson.ctl")
HR(d=2000, cor=250)
runMeep(a1=2, cor=.150, file="mcc.ctl", res=40)
sim1 <- runMeep(a1=2, cor=.250, file="mcc.ctl", res=40)
plot(refl~wl, sim1)
sim1.r <- HR(d=2000, cor=250)
plot(refl~wl, sim1, type='l')
lines(model.s~wavelength, sim1.r)
lines(model.s/100~wavelength, sim1.r)
sim1b <- runMeep(a1=2, cor=.250, file="mcc.ctl", res=40, "TE?"="false")
plot(refl~wl, sim1, type='l', ylim=c(0, .25))
lines(model.s/100~wavelength, sim1.r, lwd=3)
lines(refl~wl, sim1b, type='l', ylim=c(0, .25), col="blue")
sim1 <- HR(d=150, cor=250)
sim2a <- runMeep(a1=.15, cor=.250, file="mcc.ctl", res=60, "TE?"="true")
sim2b <- runMeep(a1=.15, cor=.250, file="mcc.ctl", res=60, "TE?"="false")
lines(refl~wl, sim2)
plot(model.s~wavelength, sim1, type='l')
plot(model.s~wavelength, sim1, type='l', xlim=c(300, 1000), xaxs="i")
par(mar=c(4,0,0,0))
plot(x=as.numeric(specs_full[191, 32:41]), y=simdat$cor[1:10], xlim=c(0, 15), type='l', xlab="Reflectance (%)", yaxs="i", tcl=.5)
lines(x=as.numeric(specs_2layer_mel[228, 32:41]), y=simdat$cor[1:10], lty=2)
par(mar=c(4,4,2,2))
plot(model.s~wavelength, sim1, type='l', xlim=c(300, 1000), xaxs="i", xlab="Wavelength (nm)", ylab="Reflectance (%)")
lines(refl*100~wl, sim2, col="red")
legend("topleft", bty="n", legend=c("FDTD", "TMM"), col=c("red","black"), lty=1)
sim1 <- HR(d=150, cor=250, phi=.75)
sim2b <- runMeep(a1=.2, r_out=.375, cor=.250, file="mcc.ctl", res=60, "TE?"="false")
sim2a <- runMeep(a1=.2, r_out=.375, cor=.250, file="mcc.ctl", res=60, "TE?"="true")
sim1 <- HR(d=150, cor=250, phi=.5)
sim2b <- runMeep(a1=.3, r_out=.25, cor=.250, file="mcc.ctl", res=60, "TE?"="false")
sim2a <- runMeep(a1=.3, r_out=.25, cor=.250, file="mcc.ctl", res=60, "TE?"="true")
sim2 <- .5*(sim2a+sim2b)
plot(model.s~wavelength, sim1)
lines(refl*100~wl, sim2)
lines(refl*100~wl, sim2b)
plot(model.s~wavelength, sim1, ylim=c(0, 50))
lines(refl*100~wl, sim2a)
abline(v=300)
