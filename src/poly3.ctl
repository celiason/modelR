(define-param no-struc? true)
(use-output-directory "output")
(set! eps-averaging? true)
(define-param rot 0)
(define rot (* (/ rot 180) pi))
(define-param r .050)

; polyplectron melanosome locations from SPATSTAT simulation based on TEM sample a7-10
(define rr #(0.131206879894826 0.234342980710403 0.144790687559594 0.120412051636848 0.104783113675695 0.105963038680312 0.10414223235073 0.129075682725471 0.0804069712436993 0.10414223235073 0.0858154962224712 0.0861491935134331 0.0890962451676111 0.121045803654418 0.0897380031267599 0.0937004542101317 0.0884498309820627 0.0889888355502998 0.162117060195556 0.10116079748202 0.121990258573245 0.140975332356303 0.0991555237465771 0.0953195883598048 0.102569136209327 0.0877986577263219 0.0952191990867083 0.0938024688883707 0.0879075215718898 0.0882333072032225 0.167741950901387 0.0846936767900842 0.0802879379123455 0.13899399581378 0.0906921256697403 0.0921566837709349 0.0840133952772511 0.0901633041023497 0.0961189280424593 0.0848065265094126 0.0863709421261118 0.0925708732006483 0.0974038653382049 0.0833275601694902 0.100971534832651 0.0896313625624978 0.0869228387456082 0.0939043727412211 0.103866358402938 0.0924674997756621 0.0959197176147546 0.134233466196834 0.107486475533582 0.0937004542101317 0.0893106768740685 0.100971534832651 0.0922604054512273 0.0869228387456082 0.10686180828552 0.0892035254535129 0.106053258397534 0.0992519316679855 0.0926741313177484 0.0860381048875798 0.0952191990867083 0.0812353209950275 0.0947156566934476 0.0913226694786546 0.0906921256697403 0.0875805240781683 0.0842407661809224 0.0972072882148553 0.11620844874719 0.0845806765038829 0.0852564316639285 0.0949173942099562 0.0966151570918059 0.0940061661290947 0.111246791362633 0.100210909802838 0.0942094229418064 0.0960193744911031 0.0895245949694356 0.103774237446098 0.0886658260069383 0.0881248458134792 0.100591941252701 0.0949173942099562 0.0826360331912683 0.102475849117529 0.0845806765038829 0.0896313625624978 0.0869228387456082 0.114048560931932 0.102195476911911 0.0965161153875656 0.0882333072032225 0.0902693162543151 0.0892035254535129 0.0915318854904934 0.0955200503863971 0.0957200925958445 0.0914273373290288 0.143330129755998 0.101349706698813 0.0872523010968821 0.0945134885724456 0.0809995140505686 0.0844675250465292 0.0942094229418064 0.118167156050547 0.0863709421261118 0.0881248458134792 0.0860381048875798 0.0893106768740685 0.0978935811719339 0.114048560931932 0.0929832176610646 0.0919488894055762 0.107129968828321 0.0982835969841378 0.0872523010968821 0.0941078494104471 0.0950181023488524 0.0842407661809224 0.110816101432229 0.0871426187139921 0.0877986577263219 0.0976979894057641 0.0869228387456082 0.0932912799660873 0.102755456319675 0.081352968154419 0.0900571671566697 0.111246791362633 0.102008133991931 0.0947156566934476 0.100781916759526 0.0854804962596926 0.085703975062657 0.0997325733733434 0.0871426187139921 0.0993482460348189 0.0932912799660873 0.107930452952235 0.0954198720154843 0.0841271575436855 0.0925708732006483 0.0858154962224712 0.0947156566934476 0.0925708732006483 0.0836711804321277 0.0922604054512273 0.0961189280424593 0.0842407661809224 0.0852564316639285 0.101349706698813 0.098575096181776 0.0940061661290947 0.0805258286201008 0.0892035254535129 0.0832127047597395 0.101349706698813 0.0922604054512273 0.0928803031661529 0.0863709421261118 0.0967140973707716 0.0984780256548517 0.0799297743216548 0.0819386702319288 0.0812353209950275 0.0828671833859798 0.0824042346050929 0.0976000465346219 0.0873618457741674 0.0820553089674613 0.0900571671566697 0.0907975203894049 0.0901633041023497 0.0843542218096835 0.0947156566934476 0.0989624261460925 0.117842965711153 0.0983808593503289 0.0901633041023497 0.0902693162543151 0.0852564316639285 0.0946146266308893 0.0865921228778308 0.0802879379123455 0.093496090926028 0.0877986577263219 0.112528971131927 0.0914273373290288 0.103958397728401 0.0986720712137677 0.0814704454259479 0.0963177264514102 0.0992519316679855 0.0815877535434769 0.105420098957237 0.0881248458134792 0.0852564316639285 0.125010468166239 0.0844675250465292 0.0848065265094126 0.106951269840146 0.103034304746382 0.0906921256697403 0.0881248458134792 0.0835567973568711 0.0851441782490011 0.0907975203894049 0.100401606283215 0.0798100292741597 0.0955200503863971 0.0915318854904934 0.0979912306537415 0.0909027929121717 0.0900571671566697 0.092052845221034 0.0954198720154843 0.0869228387456082 0.0929832176610646 0.0854804962596926 0.152197467115484 0.0882333072032225 0.10340493293864 0.0828671833859798 0.0879075215718898 0.0845806765038829 0.0952191990867083 0.0895245949694356 0.098575096181776 0.0938024688883707 0.109163983894115 0.085703975062657 0.0905866083266572 0.0818218652256738 0.0877986577263219 0.0912178815273564 0.0925708732006483 0.080881352770954 0.112613930729633 0.0850317766445516 0.0832127047597395 0.0880162507681453 0.126304370500028 0.0946146266308893 0.0883416354296585 0.0916363143727051 0.0948165791053431 0.0946146266308893 0.0930860183753376 0.0964169719454885 0.093496090926028 0.080881352770954 0.0953195883598048 0.0966151570918059 0.0973056264172566 0.0980887829234476 0.0888812961327065 0.092052845221034 0.091844815926379 0.081352968154419 0.110902373225314 0.0889888355502998 0.098575096181776 0.0949173942099562 0.100401606283215 0.0916363143727051 0.0907975203894049 0.0973056264172566 0.0947156566934476 0.0828671833859798 0.081352968154419 0.0873618457741674 0.0905866083266572 0.0896313625624978 0.0961189280424593 0.0935983283441352 0.0901633041023497 0.0937004542101317 0.0892035254535129 0.12339338755947 0.102569136209327 0.0981862382708085 0.0969116748951348 0.0933937415894627 0.102475849117529 0.0976000465346219 0.0999241827207334 0.0976979894057641 0.0956201238034562 0.0884498309820627 0.0886658260069383 0.0851441782490011 0.0859268726434154 0.0951187038617823 0.0896313625624978 0.102941439198223 0.0911129730607578 0.0894176998925421 0.102101848420507 0.0943108870777738 0.0905866083266572 0.0921566837709349 0.0894176998925421 0.0881248458134792 0.0931887056855182 0.100210909802838 0.0846936767900842 0.0910079436620871 0.0917406243829945 0.0996366305196079 0.0893106768740685 0.0924674997756621 0.0837854073527988 0.0909027929121717 0.0877986577263219 0.0959197176147546 0.0950181023488524 0.0897380031267599 0.0927772745119607 0.0906921256697403 0.0826360331912683 0.0848065265094126 0.0834422574848527 0.0873618457741674 0.0845806765038829 0.108460826922377 0.0911129730607578 0.0869228387456082 0.0933937415894627 0.085703975062657 0.0881248458134792 0.0886658260069383 0.108637042841855 0.103497382606582 0.101349706698813 0.0897380031267599 0.0946146266308893 0.0961189280424593 0.0805258286201008 0.0869228387456082 0.101066210460419 0.106772271773539 0.0901633041023497 0.0836711804321277 0.0931887056855182 0.0994444671189084 0.0929832176610646 0.0945134885724456 0.116290720225634 0.0991555237465771 0.0842407661809224 0.102662338533154 0.0975020052777972 0.0806445108195362 0.0889888355502998 0.0902693162543151 0.0888812961327065 0.0841271575436855 0.0884498309820627 0.0864816032120161 0.103219785193089 0.0927772745119607 0.0858154962224712 0.0922604054512273 0.0819386702319288 0.0896313625624978 0.0960193744911031 0.0924674997756621 0.098865735916707 0.105420098957237 0.0849192262621396 0.0910079436620871 0.0968129365354214 0.0965161153875656 0.104234028077984 0.0945134885724456 0.0824042346050929 0.112783657925764 0.0922604054512273 0.0888812961327065 0.104965503915862 0.0905866083266572 0.0943108870777738 0.0976000465346219 0.0885578943467148 0.0932912799660873 0.0869228387456082 0.082520215288255 0.0960193744911031 0.0886658260069383 0.102101848420507 0.0999241827207334 0.0842407661809224 0.0840133952772511 0.107397459803586 0.0965161153875656 0.0872523010968821 0.109949660449462 0.0879075215718898 0.10340493293864 0.085703975062657 0.0880162507681453 0.0844675250465292 0.0935983283441352 0.0894176998925421 0.103219785193089 0.0818218652256738 0.0843542218096835 0.0863709421261118 0.0957200925958445 0.0980887829234476 0.100876770349236 0.0892035254535129 0.0801687278422695 0.0940061661290947 0.0849192262621396 0.117028560889699 0.080881352770954 0.0834422574848527 0.0837854073527988 0.0978935811719339 0.082520215288255 0.0937004542101317 0.0943108870777738 0.104783113675695 0.0859268726434154 0.092052845221034 0.0833275601694902 0.0916363143727051 0.0883416354296585 0.0983808593503289 0.0873618457741674 0.0865921228778308 0.102195476911911 0.0889888355502998 0.0821717821403064 0.102662338533154 0.0826360331912683 0.0938024688883707 0.100686973811687 0.0853685374739129 0.0995405951907668 0.0805258286201008 0.0887736264431115 0.0886658260069383 0.0860381048875798 0.0982835969841378 0.0932912799660873 0.0986720712137677 0.0859268726434154 0.0956201238034562 0.0861491935134331 0.0809995140505686 0.0814704454259479 0.0925708732006483 0.098865735916707 0.0971088504293893 0.100019849743815 0.0871426187139921 0.0888812961327065 0.0932912799660873 0.0955200503863971 0.0845806765038829 0.0902693162543151 0.0818218652256738 0.0984780256548517 0.0858154962224712 0.0961189280424593 0.0950181023488524 0.13387674628319 0.0957200925958445 0.0951187038617823 0.0962183785895393 0.0800493402438736 0.083097690600057 0.0815877535434769 0.0860381048875798 0.0877986577263219 0.091844815926379 0.0889888355502998 0.0917406243829945 0.0911129730607578 0.0976000465346219 0.102195476911911 0.0919488894055762 0.0902693162543151 0.0953195883598048 0.0812353209950275 0.0886658260069383 0.0841271575436855 0.0935983283441352 0.0939043727412211 0.113375702192735 0.0882333072032225 0.0916363143727051 0.0837854073527988 0.0879075215718898 0.0862601390758407 0.100210909802838 0.0916363143727051 0.0959197176147546 0.104691799398066 0.0897380031267599 0.100876770349236 0.093496090926028 0.0832127047597395 0.0893106768740685 0.0909027929121717 0.0862601390758407 0.0855923085982132 0.0899509049755231 0.0841271575436855 0.0926741313177484 0.0949173942099562 0.0892035254535129 0.0945134885724456 0.0824042346050929 0.0853685374739129 0.100306303360661 0.0883416354296585 0.0994444671189084 0.0819386702319288 0.0929832176610646 0.109426502871748 0.0809995140505686 0.092052845221034 0.092052845221034 0.0926741313177484 0.0951187038617823 0.0943108870777738 0.0941078494104471 0.087032798104874 0.0861491935134331 0.0937004542101317 0.085703975062657 0.0928803031661529 0.0888812961327065 0.0801687278422695 0.0981862382708085 0.0956201238034562 0.0901633041023497 0.0833275601694902 0.0915318854904934 0.0901633041023497 0.0907975203894049 0.0904809679311553 0.0894176998925421 0.0926741313177484 0.0954198720154843 0.0834422574848527 0.0854804962596926 0.091844815926379 0.0900571671566697 0.0965161153875656 0.100971534832651 0.107308370232215 0.091844815926379 0.0953195883598048 0.0811175032085968 0.0978935811719339 0.10686180828552 0.0832127047597395 0.0905866083266572 0.0834422574848527 0.0846936767900842 0.0876896587299498 0.0876896587299498 0.105147577780223 0.0896313625624978 0.082520215288255 0.0906921256697403 0.107930452952235 0.0931887056855182 0.0925708732006483 0.0892035254535129 0.105963038680312 0.0815877535434769 0.101255296145767 0.0915318854904934 0.0873618457741674 0.101349706698813 0.0940061661290947 0.080881352770954 0.0846936767900842 0.0907975203894049 0.0902693162543151 0.0906921256697403 0.0993482460348189 0.102289019702124 0.0861491935134331 0.0880162507681453 0.108107533387881 0.080881352770954 0.0925708732006483 0.081352968154419 0.110036611558702 0.0836711804321277 0.0919488894055762 0.105056580292142 0.0828671833859798 0.0889888355502998 0.113037770883106 0.0872523010968821 0.0872523010968821 0.0966151570918059 0.0835567973568711 0.0867025016643568 0.0935983283441352 0.0862601390758407 0.119934539967365 0.0875805240781683 0.100401606283215 0.123315854791804 0.0981862382708085 0.10049681882835 0.0851441782490011 0.0872523010968821 0.0905866083266572 0.0807630186142832 0.165849740518457 0.0854804962596926 0.0827516889976099 0.100115425350661 0.0895245949694356 0.0873618457741674 0.0892035254535129 0.0879075215718898 0.0861491935134331 0.0921566837709349 0.0817048932355925 0.0824042346050929 0.102941439198223 0.0919488894055762 0.132006264570248 0.126531332714527 0.0829825170303623 0.0884498309820627 0.102289019702124 0.0898445171145526 0.0925708732006483 0.0926741313177484 0.0901633041023497 0.0930860183753376 0.0799297743216548 0.0812353209950275 0.103866358402938 0.087032798104874 0.0879075215718898 0.0858154962224712 0.0966151570918059 0.0915318854904934 0.0864816032120161 0.0837854073527988 0.0955200503863971 0.0901633041023497 0.0821717821403064 0.0855923085982132 0.085703975062657 0.0827516889976099 0.082520215288255 0.0883416354296585 0.1568396403146 0.104417377433544 0.100781916759526 0.0821717821403064 0.0817048932355925 0.0930860183753376 0.0859268726434154 0.087032798104874 0.123934758828916 0.0889888355502998 0.0962183785895393 0.0941078494104471 0.0812353209950275 0.0945134885724456 0.0941078494104471 0.0848065265094126 0.0880162507681453 0.0895245949694356 0.0873618457741674 0.0838994787566816 0.110902373225314 0.0931887056855182 0.0836711804321277 0.0853685374739129 0.100210909802838 0.0833275601694902 0.0828671833859798 0.0976979894057641 0.0924674997756621 0.0886658260069383 0.10686180828552 0.108107533387881 0.0798100292741597 0.0824042346050929 0.103589749766962 0.0929832176610646 0.0877986577263219 0.0869228387456082 0.0966151570918059 0.0916363143727051 0.152260293729971 0.0974038653382049 0.0892035254535129 0.0853685374739129 0.0983808593503289 0.104417377433544 0.0849192262621396 0.0859268726434154 0.0829825170303623 0.0801687278422695 0.0912178815273564 0.0798100292741597 0.0943108870777738 0.0812353209950275 0.0903752040517198 0.0903752040517198 0.0982835969841378 0.0884498309820627 0.0965161153875656 0.0869228387456082 0.0889888355502998 0.087032798104874 0.0799297743216548 0.0998284240186034 0.0929832176610646 0.0852564316639285 0.0848065265094126 0.0892035254535129 0.0871426187139921 0.0806445108195362 0.0834422574848527 0.0999241827207334 0.0877986577263219 0.0889888355502998 0.093496090926028 0.0845806765038829 0.0904809679311553 0.0828671833859798 0.0940061661290947 0.082288090453496 0.0865921228778308 0.0901633041023497 0.0917406243829945 0.082288090453496 0.0868127401089642 0.0882333072032225 0.0940061661290947 0.0843542218096835 0.0930860183753376 0.0862601390758407 0.0868127401089642 0.0899509049755231 0.0932912799660873 0.0804069712436993 0.100401606283215 0.0893106768740685 0.103866358402938 0.0939043727412211 0.10368203464029 0.0834422574848527 0.0886658260069383 0.0887736264431115 0.0964169719454885 0.0798100292741597 0.0911129730607578 0.0900571671566697 0.0801687278422695 0.0836711804321277 0.0935983283441352 0.0937004542101317 0.0842407661809224 0.0887736264431115 0.0932912799660873 0.0980887829234476 0.0909027929121717 0.0980887829234476 0.0879075215718898 0.0977958341868281 0.0873618457741674 0.0965161153875656 0.081352968154419 0.0943108870777738 0.108988619951339 0.0883416354296585 0.0846936767900842 0.104600405404742 0.0923640106556298 0.100019849743815 0.0910079436620871 0.0950181023488524 0.0842407661809224 0.085703975062657 0.0826360331912683 0.0854804962596926 0.087032798104874 0.0895245949694356 0.0955200503863971 0.0933937415894627 0.0880162507681453 0.0901633041023497 0.0889888355502998 0.0947156566934476 0.0876896587299498 0.0913226694786546 0.0882333072032225 0.0910079436620871 0.0996366305196079 0.0946146266308893 0.0937004542101317 0.0881248458134792 0.0887736264431115 0.0874712532632189 0.0902693162543151 0.0834422574848527 0.0904809679311553 0.0864816032120161 0.0961189280424593 0.0836711804321277 0.0855923085982132 0.0872523010968821 0.0824042346050929 0.0876896587299498 0.0880162507681453 0.0931887056855182 0.0799297743216548 0.0982835969841378 0.0820553089674613 0.0995405951907668 0.0836711804321277 0.0986720712137677 0.087032798104874 0.0841271575436855 0.0854804962596926 0.095819957091023 0.0901633041023497 0.0850317766445516 0.0888812961327065 0.0892035254535129 0.0840133952772511 0.0826360331912683 0.0877986577263219 0.0872523010968821 0.0889888355502998 0.0801687278422695 0.0855923085982132 0.0905866083266572 0.0852564316639285 0.0811175032085968))
(define xx #(-1.36293846758756 -0.713364575513598 -1.23738668219832 -2.11270920684755 2.28974158797631 -0.134916941074995 2.08950163905144 -1.46311841322879 0.500883107365968 1.46746879940756 0.416864281882728 3.63837608856557e-05 -1.51337952941932 1.27430989475653 -0.2562186975294 1.21769276545367 -1.50573655899499 0.734111035713555 -2.17505530458493 -2.308298414029 -2.15601349342933 -2.1332444076157 1.24961117969191 2.18953171807263 -1.43301157096758 -1.07600505746567 -2.4563568354891 -0.289631573161392 1.20994182830361 0.0573227012973402 1.52221569523497 -0.989762108212924 0.108047060743846 -0.42084310572556 1.0603080794769 -2.084520326075 1.86704583109048 0.705644235987746 -0.955062089230105 0.581717121058733 0.956874686890213 2.05653952561063 -0.840385558882894 -0.48472221605219 -1.83842654867657 -0.864611252951953 0.810831179487596 2.31869879921177 1.30372602754963 1.36999531364345 -0.132563317820716 0.0366994498357444 1.5469529779587 -2.0262764947021 0.996924067850458 -1.03908037799957 -0.282431027754775 2.25344452941446 -1.29459535075184 -1.48437948974179 -0.724121677792724 -1.24783872690501 0.96816394746171 0.77701824465245 1.86171624520463 -1.91423083978611 2.01869086374808 -0.480763571659443 1.93704578334656 0.722540560173535 -1.77294447680942 -1.19220664353811 -0.0405969253218664 -1.86062184795312 -2.20106410504467 0.894595894047902 2.31811431955824 2.32129999568838 0.973240755977258 2.32292698422527 0.145977821703848 1.68661530267789 -0.650162727176229 -1.31477680939845 -1.40293448010088 -1.82347998709374 -1.50022103636003 -1.94417385263735 -1.49092723973398 0.187413295619967 -0.835961300473945 2.27538755510725 1.67150753927766 1.54390836206217 1.71996112530808 1.02299512381526 -2.20178158270067 0.0416845741385287 0.382532458427045 1.00523426239939 -1.90950965847577 1.50129410170856 -0.259834920180692 0.319291709865589 -1.64323138983328 -1.07610443183193 -2.31589877003822 -1.00001495966957 -1.7866772536069 -1.63275628289791 -0.413116164291015 2.1625056474478 0.5058082711913 1.13475525688164 -0.768967636824036 1.22681874518275 0.471498986421403 -2.0043793020607 -2.18945782114703 2.48793545393212 -0.785869524064557 -1.29596672688432 -2.16938200785675 0.953893692978598 0.239248855081101 -0.563469275857378 0.995489966999954 0.63063338070412 -0.660227055450209 -0.209832490151063 0.674341093297861 1.85809628860598 -1.11559190145893 -2.48869363951689 -1.45230287171003 1.7187472351556 0.63556248097925 2.23941446422338 -1.65391200710688 -0.763780574786962 1.38543201343997 -1.71057863426133 -2.19669749726831 -1.2158196294433 -0.026046998510742 -0.437959212555444 -0.175894840156994 -1.842408884208 -1.76362772332182 -0.800269078822728 0.0147446790016511 -1.4571811125928 -1.86904841884114 -1.65857632309897 1.76846265996412 -1.20535909115882 -1.2247391357128 1.60445653615744 -1.90312233157208 -0.917091983528473 1.2125466089087 2.48869363951689 -0.661307746744144 0.586426914488176 0.585443626866055 -1.79419876866763 -1.99989223990839 -0.955416504713411 2.00429489641111 -0.690741707983434 0.460110163798466 1.28371180134173 -1.02211846113442 -0.46169687575325 1.83179751453576 2.37487984528053 -2.35454974161394 1.02227593888262 -1.03695342905766 -0.648793916074607 1.65491729834738 -0.211161251868433 1.01157351390763 1.10152143950137 2.15460785981155 0.776410304350821 0.397567650222489 -0.779009638792834 -1.56182985400806 -2.41120848434426 -1.1170572815272 1.57572519581006 -2.13566881452642 2.0438896840975 -0.989457131312193 -0.565607383835974 -0.773104165612918 0.340925183419682 0.241316612396271 -1.60310067862629 2.04113986729633 -0.491413918934741 -1.09154889092911 1.66874993189496 0.264796801155068 1.37255320094049 1.43165977500968 -1.76664968199456 1.35503483207607 1.86766528110375 0.272636645106423 -0.299855425610625 -2.41891190915442 0.218305429157891 2.20561239207989 -0.471227172175732 -2.34282707808448 -0.604587912486178 -1.65935085375842 -1.7275869735752 -0.0225312006041941 1.73818562839935 2.4268640300053 -0.85584879637672 -2.01042183481634 -0.46246815155647 0.00182244866276596 -1.3128692874866 -2.03483691146865 1.81351075100035 0.737524390436441 2.16626303076074 0.897903960674852 2.03059784729987 0.325506519510878 0.855573957765398 -0.408932753718609 1.92806906273021 1.51940816359312 -1.2881139161916 2.26438237746561 0.834704298705249 1.2361264041707 1.63940765980752 -1.49618352796973 1.71546384913045 -1.1339432418688 -1.09529950275814 -1.56801610257804 -1.46739834337701 1.68512727361762 -2.34580965085655 -1.25111845965451 1.65308046789574 -1.96698868589159 -0.382017160520438 2.06208842822034 0.056592125191075 0.526083144376368 -0.385477806970803 1.00487189005207 1.77787040948547 2.30357066538355 -0.520771316143172 -1.83826310122242 1.14649032903599 -0.856340877296698 2.39976093766118 -2.43730122782606 0.138406849950573 -1.64705618011569 1.92425032611818 1.59226295238942 0.495999910935767 0.194725156451132 -0.309724370314531 1.87386534099842 1.51028598201949 -1.94677364312144 0.699152215324543 -0.00816065473159961 0.772577311896558 -1.40115922685346 2.33510366315578 1.35206066397828 0.607082097126602 0.0671447872667813 1.15519216165018 -0.235757729544544 -2.36599811312401 -1.25942325907755 1.51442175018946 -0.86795254314933 -0.743462155346305 0.728156584932219 0.00626635968619394 -0.621416232073351 -0.701999730496196 2.12152125676331 -2.17714467862358 2.28752333677745 2.41665021542074 -2.45500828450927 -1.50043919898463 1.3271523292577 0.382449269438434 -0.428127648484171 1.31303977807427 1.89072617786704 -2.23852004059717 1.08473511365111 1.00173539402578 2.02898803525011 0.884889986854199 1.10022136562913 -1.78937700126913 -0.527812572804199 -2.41531751889993 -0.996419354400457 2.43424916214479 -1.61549202166371 2.25820816708923 2.14437200703502 1.91912959597668 -0.157006939084718 -0.32443926911035 1.69082509289692 1.78215679830895 -0.0402506478023179 0.565970307714324 -1.95932488076539 -1.93862444459473 2.06441582823231 0.0762366971957454 -2.20894572212053 2.2515472610406 1.23537876352987 -1.04206397480835 -1.23525161340263 1.26535743327349 1.44975951355119 0.700196179591268 0.44696779355509 -2.43333104244082 -2.28856890624641 0.807573389441109 0.202502646115749 -1.71198646741777 0.298125397907291 0.991748988030708 1.69317023409794 -1.10049922860611 1.99705267666167 -1.59626820197699 -1.68618920791761 -0.223621858970835 -0.290975919334544 1.1128865594611 0.690928532121266 1.2890193885483 1.42668599413605 -2.3755097480415 0.261888373909149 0.363987770995994 0.262791971060359 -0.532540354376877 1.72730768814209))
(define yy #(0.633458135754397 -2.32233371217938 1.10660775493007 -0.216432919587989 0.341719589775565 -2.21177374849065 1.39600883504413 2.46931228692888 1.57664914939519 2.35684696958609 -1.87359510808275 0.40984179620972 0.793534102157377 0.0320536414138783 2.23223501940598 2.47480931269497 0.450457321298034 -0.388653908686978 0.359806873594067 0.229937329613712 0.567557985259994 -0.91156621476415 1.00844130582927 -1.31510989544832 1.02752778770521 -0.828141714174836 -1.24876227054619 -1.99467295940444 1.33186088709301 0.125101230639573 -0.919368587533001 -0.366893102259544 -1.19890801796994 -0.91890258497554 -0.317518930275976 2.31136140414049 2.24928203833153 2.17532617628878 2.3466330792689 0.00828096175822111 1.32514821615332 -2.4013056155432 -0.200425230422188 2.48712590105256 1.7628093821658 0.66853801473395 -1.67982657560979 -1.59895001500273 -1.55567205373765 -1.97441630814591 -1.14204005235671 2.43303196856842 1.52377547354256 1.62590014556762 -1.686505489558 -0.17315766000175 1.42060506741241 1.48706256717298 1.41045807039998 -0.0474435104640693 -1.00194114061687 -0.119984968722551 -0.568964623158154 0.631960193952927 0.837502483130991 2.2126005560595 1.20770367835926 1.35629903420578 0.182198325289827 -0.159405729437257 -1.76308540944996 -0.41642439473091 -0.294337078642907 -0.861119270484355 -0.672225645012604 -2.29115042294358 1.70294706406561 -0.452288022346664 0.222747228722991 -2.09997934147535 -1.72466724817507 -0.417103713025398 2.07332218913025 1.70629898811043 -1.47235794661057 1.50533614170826 -0.913223716960821 -1.61043113593118 0.151263513128702 -0.673789093882644 -1.40710021616187 -1.90901526194866 0.890257859694565 -2.46597067569105 -0.623081843422456 -2.13401490880595 0.858386681207513 -0.0912579550125806 0.55536884008195 0.681886818924242 0.928494619945647 -2.12417995487682 0.223186800596624 0.941727765610363 0.966054503456005 1.32583095887925 -1.54147260102095 0.387845476156257 1.9522028346873 -0.736419547845855 0.484246350967541 -1.01043594659408 -2.35989919496441 0.369013556306244 0.482347263364479 -1.83853319255102 -0.851875416227426 -1.78927723095299 -0.392031158707214 -2.25189758778569 1.34989825488416 -1.06027791402253 -1.97390023644951 1.6146635455077 -1.94663068874919 -0.275164783478498 -1.89957365006871 0.465343387336007 0.943778469915499 -0.535420394238599 -0.60034240034349 -1.05274891954256 1.58618363251438 -2.37403820646617 -1.17185776229805 0.0927035310011383 1.71045740856512 -0.208935890858432 2.30687192348347 -0.410659601475151 2.12695459551322 0.052442177734662 1.06583709815837 -0.65042090543468 -1.35722862410872 -1.15200686335995 1.63179287261859 0.686365999945156 -0.589222151927242 2.23315062346993 0.764438672307861 2.06604498585018 -0.169336878609027 0.23703118093187 -1.39051295679184 0.244897560934174 -2.35348164086781 1.78708592410268 -2.31164232441034 -1.02753217196527 0.588020726375937 -0.763196026809438 1.19023842440214 -1.36923016971278 0.948690510595149 -1.44318265671493 -0.732701328174805 -2.48712590105256 0.650564408868415 -1.20037779217644 -0.622605669645069 -0.690318202126253 0.151593700759559 -0.0975723250629476 0.48594521799112 -0.931425315874102 -2.1542917889054 1.8297880705136 -2.01977425589768 1.48680647567744 -0.108745500701302 -0.212676764460557 -1.46511006667108 0.893419182848801 1.83502204232233 1.18549964019709 -0.112999729503734 0.0870654482941595 1.84568719038545 1.6959419219854 2.20068639107985 1.32814597331538 -1.12651234170919 0.88857468414025 -1.83346460102457 -1.53119254673704 -1.63133734256516 1.2134583514323 0.0389420449555187 -0.472841418699577 1.99354945777841 -1.79397578796677 -1.24915889050065 -2.02586082058548 -0.490906498043631 1.67429908722112 1.09646251293876 -0.357791944719327 0.463127913548612 -2.0940929940743 -0.912287291365888 -1.69633773851556 2.18001730656686 -2.14072468379616 0.778580818481475 0.242007605861704 1.99166445314965 0.700725182632266 -2.16479583228644 1.26817050245147 -0.68126239689994 1.59166390490819 -1.11475063801494 1.09814881987221 -2.12824596671979 1.54456332326484 1.3799450313008 -1.858466589006 1.90487133111951 -1.8710884357921 -1.86777203363804 0.506762521116522 2.21361409227724 -0.525951036232162 -1.12897897943284 -0.722577162900469 -0.565228626078111 -0.70269980035131 -0.63685857477312 -1.28079595147603 2.4061895133233 1.81971325327196 -1.35583255091083 1.12203626572563 1.33905014010767 1.95956515319867 0.654666619256625 1.88003182088545 1.64433388471269 -0.621079632688527 -1.70849293737058 0.547669750141008 0.872758893197714 2.27078699198581 -0.493887910131008 0.82908135675969 -2.11784460689115 1.89857402560371 0.192226506055763 1.05693047795854 -1.0467768839765 1.28536835441113 0.942724999558801 -1.99026990448229 -2.03066580497719 -0.887033364012039 2.02777417061623 2.23418737667429 -0.317451131472517 -1.52197164440258 0.610966338337657 1.60507183816349 0.323006349524058 1.98746257205015 0.596332270941109 -1.4887524714058 -1.64064592516178 0.0184331793822371 0.0154903102585499 -2.41488279473706 2.10235577835774 0.135624890415148 -2.42157140410678 -0.648121773445714 -0.510134789247554 1.27733401098571 -2.32256115040337 -2.42813279420209 -1.31174929837233 1.14702817797609 2.04776940440051 -1.80467751488458 0.898518819809717 1.70138016112962 -0.889512472922314 1.70705693332645 -0.667660576616958 -2.07154455853715 0.246760278770422 2.13065834202235 0.0186033028313454 0.717759313841796 0.374977073599093 -1.84105688492448 -2.27730403734031 -1.51787907181324 2.15270657513937 1.48996462793987 -2.30742394183184 1.60207767171536 1.12026131376232 2.38966900731733 -1.17005109153852 0.411670133083567 -1.207161704461 -2.47690848916861 -2.44819539215046 -0.614512114836569 -1.60618908855579 1.93338023818116 -1.56431442966093 2.06046264564308 -0.695895297026347 1.79131987138063 -0.933271071250186 1.87542172615543 -2.22557255425322 -0.25488914473544 1.05206392294805 -1.73806490813605 -1.30109558758096 0.421443809446227 -1.65471417605615 -0.485129776900471 -0.0359823911786848 -2.47136554309398 1.87500551120914 1.12519580093153 -1.56512528563544 -0.194083273942381 1.93808812841698 -2.09417569409361 -0.369841188702095 0.717903782043234 2.43346694050866 -1.41420525615122 -0.204980363027569 -1.17461934399686 2.44883988661136 -0.0782655402927571 -1.15198688476594 -2.20827000853404 -1.43074331895377 -2.44007196247035 -0.959708997421299 0.664658655807241 -2.48443637235473 2.01902843777877 1.96890630411393 0.808199572248789 -0.295289564492028 -1.77986939911358 1.88130163793027 0.34422286397656 1.65112356913986 1.81383587853984 0.660670548133207))

(define sx0 1) 		; width of original image
(define sy0 1) 		; height of original image

(define sx (+ sx0))
(define sy (+ 5 sy0))

(define fcen 2.4)
(define df 3)
(define nfreq 100)

(set! geometry-lattice (make lattice (size sx sy no-size)))

; material properties
(define-param eps1 1.96) 	; permittivity of material 1 (low index)
(define-param eps2 2.72) 	; permittivity of material 2 (high index)
(define-param k1 0.01) 		; extinction coeff mat 1
(define-param k2 0.01) 		; extincion coeff mat 2
(define mat1 (make medium (epsilon eps1) (D-conductivity (/ (* 2 pi fcen (* 2 (sqrt eps1) k1)) eps1))))
(define mat2 (make medium (epsilon eps2) (D-conductivity (/ (* 2 pi fcen (* 2 (sqrt eps2) k2)) eps2))))

(set! default-material mat1)

; I think this worked at creating a geometry with cylinders at the (x,y)
; coordinates specified by the vectors X and Y
(define (doit x x-max dx)
	(if (<= x x-max)
 	  (begin
		(set! geometry (append geometry
			(list (make cylinder 
			
				(center 
					(+ (* (vector-ref xx x) (cos rot)) (* (- (vector-ref yy x) 1.987) (sin rot)))
					(+ (* (* (vector-ref xx x) -1) (sin rot)) (* (- (vector-ref yy x) 1.987) (cos rot))))
				(radius r) (height infinity)
  				(material mat2)))))
		(doit (+ x dx) x-max dx))))

; define geometry
(if no-struc?
	(set! geometry (list 
		(make block (center 0 0) (size sx sy infinity) (material mat1))))
	(doit 0 362 1)) ; do loop from a to b in steps of dx

; excite sources
(set! sources (list
	 (make source
	  (src (make gaussian-src (frequency fcen) (fwidth df)))
	    (component Ez)
		(center 0 (- (* 0.5 sy) 1))
		(size sx 0))))

; (set! pml-layers (list (make pml (thickness 1.0))))
(set! pml-layers (list (make pml (direction Y) (thickness 1.0)))) ; only on y extremes

(define-param res 50)
(set! resolution res)
(set! k-point (vector3 0 0 0))
(set! ensure-periodicity true)

; define flux regions (planes)
(define refl ; reflected flux
	(add-flux fcen df nfreq
	 (make flux-region
	  (center 0 (- (* 0.5 sy) 2)) (size (* sy 2) 0))))

(define trans ; transmitted flux
	(add-flux fcen df nfreq
	 (make flux-region
	 (center 0 (+ (* -0.5 sy) 1)) (size (* sy 2) 0)))) ; changed from (* sy2)

(if (not no-struc?) (load-minus-flux "refl-flux" refl))

;(run-sources+
;	(stop-when-fields-decayed 50 Ez
;		(vector3 0 (+ (* -0.5 sy) 1))
;		1e-2)
;	(at-beginning output-epsilon)
;	(at-end (output-png Ez "-Zc bluered")))

(run-until 10
	(at-beginning output-epsilon)
	(at-every 1 (output-png Ez "-Zc bluered"))
	(at-end output-efield-z))

(if no-struc? (save-flux "refl-flux" refl))
(display-fluxes trans refl) ; print out the flux spectrum