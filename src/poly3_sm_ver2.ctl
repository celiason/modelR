(define-param no-struc? true)
(use-output-directory "output")
(set! eps-averaging? true)

; morphological parameters
(define-param rot 0)
(define rot (* (/ rot 180) pi))
(define-param r 0.094)		; radius of melanosomes
(define-param a .203)		; spacing between melanosomes
(define-param cor 0)	; keratin cortex thickness
(define-param pad 2.5)
(define-param dpml 1)
(define mag (/ a .08)) ; expands points so spacing between = a

; phi =0.6
;(define xx #(0.0821528641957863 -0.331497039461204 0.453752834010417 -0.493756866030159 0.412244378587153 -0.452840043100154 0.18085577090475 0.0187688545476457 -0.327507642182977 0.195865073265446 -0.183000559423012 0.0150347231332664 -0.0294824729384939 -0.173267038108273 -0.429444070667429 -0.26071112810307 0.235948170500195 0.221829685670087 -0.00473033819767776 -0.095094046802091 -0.0179643366731131 -0.112713384072393 0.155891625559602 -0.212335538745586 -0.0950771116622676 -0.490616106549675 -0.408631025021847 -0.431767350532653 0.376238184308854 -0.278686964715514 0.438148374400356 0.254535000600155 0.467698939866844 -0.446198076271962 0.203164666554215 -0.353738640766521 -0.0909462780413451 0.188191827612698 0.307073019213366 0.191926748168431 0.391114711868102 -0.115452619195268 0.0372259791695931 -0.259195557063157 -0.0343136522165683 0.0832809723784007 -0.18190983779832 0.403001924991466 0.298728004030087 -0.205109765022968 0.0654711878255624 -0.07356167877317 -0.178676302613564 0.288863276215403 0.295369766572684 -0.258251385283908 0.0302310802662274 -0.176509349841642 0.189724381710213 0.479602955960025 -0.0863505490409731 -0.15980925211761 -0.00873355544325 -0.0580866245872602 -0.305831552887359 -0.389864385581331 0.280802474137556 -0.385392263632773 -0.23159761756267 -0.321057328667985 -0.235086182794343 0.137115127252033 0.353865001332215 0.486162350581778 0.0157583472864022 -0.441878285231853 0.380039063510594 0.337972140253594 0.124006381900663 0.259086535434592 0.238949710813981 0.071426672776067 0.116364674688569 0.398125428781532 0.105661507206011 -0.431481883705919 0.451130503845218 0.493756866030159 0.09875248208121 0.409590155211152 0.142257751609528 -0.343615237738999 0.284142507729925 -0.287201691851984 0.334046782440546 -0.335428826564418 0.34173685267078 -0.401542141303338 -0.1392996321631 -0.34673345708464))
;(define yy #(-0.312778316411278 -0.186612711573096 0.257743487608271 -0.288094267097919 0.0797010234924191 -0.0313002634092412 -0.107427694979241 0.295999397946978 -0.357741138084868 -0.483464980527111 0.268715477327823 -0.382082519327955 0.206635766374804 0.174122868366429 0.24673191940397 0.335664866874378 0.27755060741471 -0.194413790535043 0.089610604290738 -0.232637066761262 -0.085794562389596 -0.133819787872297 -0.0157474791925784 -0.172272227737812 0.119239299280166 0.335749819855663 -0.115561414119619 -0.374563593247518 0.446527154875682 -0.0878584429333803 -0.208238974034371 -0.012787100299087 -0.389837521811571 -0.203686353538773 0.067101635429915 -0.028392109379041 -0.33499566272739 0.168968553818556 0.0706171577480877 -0.293082422910761 -0.109069284279487 -0.432198119809877 0.0019597321979124 0.014850166007708 -0.491697219804803 -0.090553678572379 -0.0456427892498855 -0.462426130472763 -0.463851411024772 -0.47195061023814 0.17913684080708 0.00124059235726864 -0.287571673186508 -0.287578400488678 0.353154545115068 0.125597870039091 0.418397708977043 0.0638975734975127 0.374912904903576 0.15942803787921 0.290156922932632 0.361894858538018 -0.283037271626574 0.384224955451626 -0.463434047679547 0.332647202082687 -0.109774233300089 -0.280252221107602 -0.369058859961613 0.261657626701964 0.433102555129812 0.253130006746936 -0.0153387644403292 -0.119990025766868 -0.185259559427956 0.0926815368518069 0.170015130538383 0.260645950603247 0.447051022160764 0.444792890625864 -0.384630729702057 -0.469645042185327 -0.199367749554533 0.340392509451998 0.0930339385495174 0.429343268999313 -0.0271834527141558 0.491697219804803 0.347647611078621 -0.302690642505373 -0.388061764382832 0.0662396528816978 0.162667112289922 -0.271988031242001 -0.372343492376637 0.440197569246088 -0.199247963596218 -0.471180042316188 0.456192485219752 0.165478237286569))
; phi =~ 0.6
;(define xx #(-0.178463736501254 -0.0100981135920475 0.431294849274334 0.183455611526423 -0.109165805234002 0.0276759784266351 -0.333338149366651 0.0361507764682753 0.495121208349358 0.237389154907528 0.383165925507181 0.35617490360492 -0.288238483419293 0.125828140492953 0.313024983477616 -0.265311106849875 -0.447797204312706 -0.224713639588754 0.226634508214361 -0.297671073772538 -0.440992356183828 -0.131676345559769 -0.210362898000501 -0.20786559953256 -0.0457749589840746 -0.128541456854814 0.295790462470135 -0.423737603651961 0.152697117909338 -0.304806807965752 0.485829856100798 0.19008920325472 -0.171629497881633 0.157292611177492 -0.346713493151204 0.00726831310448967 -0.0813230085564239 0.391531991974296 -0.137032517869514 0.428244680170765 0.372052386669043 0.461322496271494 -0.495121208349358 0.328033391733445 0.260315180285543 -0.0207515170994558 0.0615116088572312 0.246112604040026 0.234907766606291 -0.453706051621621 -0.352383734356939 0.333409567891592 -0.429023436520702 0.257069240726278 0.142082533830125 0.414315678808058 -0.0207196712552206 -0.394507133601244 0.289950918580588 0.0633122557854195 -0.184002477057081 0.33462596568409 -0.125118435312105 0.0554179178113446 -0.10204375892609 -0.264767493148549 0.323915770458048 -0.304375334742805 -0.466168277551277 -0.0400400647843054 -0.399058248085124 0.166916134233271 -0.017518899612059 0.450365540233569 -0.349347390365256 -0.223247351436274 -0.388685929372451 -0.28216142976465 -0.436936737162436 0.268576137184653 -0.490512375946097 -0.364275877407619 0.072061665389799 0.471308700946899 0.15711245702235 -0.12919131577868 -0.35183360701804 0.0862448373127269 0.415682505705009 0.405913174080542 -0.267466611425947 0.179541022931692 -0.221320480466757 0.397952975273879 0.067715178085013 0.470181410660523 -0.0873799624079578 -0.0333318072981311 0.107543722002288 -0.0217161164004167))
;(define yy #(0.107638888360573 0.273126100163873 -0.33140935520495 0.289292604048706 0.0139118332474434 -0.475101159539019 -0.260664731997603 -0.199353220257452 -0.437040112868824 -0.156013083214596 0.139412236077808 0.339371773225954 0.270237586585553 0.498389694339715 -0.338798021671554 0.167598997976587 0.353107766206472 0.358569581616595 0.479824108664097 -0.17638021764987 0.170013083658133 -0.207552780593842 -0.399659606498556 -0.141621635435919 -0.238515129670771 -0.489469273180297 0.271969029827842 -0.268811403732567 -0.213775346614244 0.441167876593703 0.000402711272065981 -0.427018409940849 -0.0518163415869866 0.400789737905449 -0.0905536728955361 -0.1128111278145 -0.403775601278553 0.240697090205329 -0.329788756692583 -0.498389694339715 -0.409489178245345 -0.245996544439268 0.432502685462039 -0.0231720110834934 0.0500332522819982 0.366512773108116 0.135764527346647 -0.273357687286645 -0.0535264221620486 -0.35601229193359 0.00532374736652352 -0.218425351861826 0.0614494804539506 0.174218630392002 -0.0343422843907603 -0.0633941623884606 0.18321283025254 0.430028983763984 -0.449880695903174 0.0392937544759266 0.257162661723849 0.455896700084587 0.181022787426383 -0.383655629602394 0.297389396000237 -0.0317075416826454 -0.114085513417686 -0.454227007452836 0.264642515038686 0.458192197901316 -0.455342808016287 0.0802559098760576 -0.0208191960409858 0.327607671247237 0.348345045447185 0.484782599622017 -0.184521522348262 -0.342916355165416 -0.0795609689908583 0.389883885746097 -0.167721653794629 0.218732657217558 -0.294850254218989 0.0914674111163485 0.196355126746592 0.407270390131351 0.122385401644661 0.316860415842307 0.411351489672793 -0.155008655595565 0.0691277937332448 -0.33590689533577 -0.273900737828063 0.0373526658271627 0.417804465987706 0.194345250735642 -0.0855328637044884 0.085062222507596 -0.128809507907666 -0.332839704067776))
; phi = 0.75
;(define xx #(0.319880344504253 -0.248182918576651 0.327366997729685 -0.125282116357744 -0.117708062113487 -0.207148619411692 -0.0238516195651973 0.456384384486953 -0.300334596193125 -0.0246713041664837 0.245232826237024 0.0996248882576027 0.280817660783439 0.439511001266126 0.472565662715498 -0.205733648844385 -0.279108600060387 -0.484449033914441 0.484449033914441 0.0175885979366112 -0.372427641775813 -0.129169193290637 -0.148146016571494 0.243585112574446 0.309515844659641 -0.176352278829211 0.055547780096899 -0.425511824493336 -0.0311658630763769 -0.266544391167276 -0.364525798963364 0.43360872439527 -0.109117855085933 -0.436428877231396 0.360546941897331 0.150964184612023 0.0033778893990411 -0.0808607918095297 -0.204123368013537 -0.322212890549722 0.382454179756605 -0.465864293111697 0.303659162845077 0.247044399840191 0.437771325699228 -0.225104800939711 -0.0591434203340768 0.0432428578529909 0.182626570791699 0.280113185648447 0.241371391962655 -0.174792077648667 -0.336429102375327 -0.483483548454057 -0.329307581950606 -0.127603930647122 0.345397040136865 0.143839291731703 0.146187608402877 0.144958749571742 0.426763928078192 -0.0326822664777707 -0.252150439337736 -0.169845897527336 0.0505545762810212 0.426810380611108 -0.306643899932184 0.414225327207847 -0.0308565548904497 -0.241832507958756 -0.300353833921421 0.091604412362753 0.210839824872804 -0.407285339475783 0.241640663114139 -0.388880269504129 0.0826262519775099 -0.423563885929004 0.159423347415758 0.191184599250419 0.045679926977671 0.0694237981679172 0.340926563687226 -0.0999152156634623 0.480303206587288 0.341355898781015 -0.372287507593304 -0.470544229640478 -0.45983089193457 -0.363408767298552 0.233481428355989 -0.0340953822180289 -0.474934966839438 0.156627893291343 0.386792649157714 -0.104698153301789 -0.270661150588055 -0.423537303314724 0.0634494385260752 0.139837813048072))
;(define yy #(0.143418501188206 0.281941914541686 -0.36409456147132 -0.289894354034393 -0.462780963321728 0.187846276560929 -0.490872834516976 0.0216062412901604 0.0131334515996638 0.085351857369272 -0.291105077206808 -0.0636661802400835 -0.0109934135774435 -0.255369119854912 0.207932670550233 -0.0181901130435222 -0.0873898336323937 -0.0629204159864518 0.490872834516976 0.412714296870827 -0.0561393584936391 0.250788161275902 0.347872491720017 0.0807900375214139 -0.105896255349436 0.0756847278648025 0.156941320659387 0.201102843008816 -0.11928054149989 -0.353404316481238 0.283717334521929 0.406594249838411 -0.188752833294586 -0.238325719400121 0.0455074346998224 0.114335347086687 -0.0231814386611569 0.421821300387493 -0.155507168146602 -0.436101372273331 -0.17563621391971 0.400112568969627 0.329556249371203 -0.185961663701038 -0.388040434881274 -0.460720957764215 -0.376866313185882 -0.185676821175152 -0.475595858470288 -0.478696066782179 0.417687019701392 0.449972193673571 -0.275332105506175 -0.323666516333861 -0.174407417385099 -0.0815321612332579 0.239434718855952 0.432024616172875 0.22327119675178 -0.349769661682856 0.300556926583872 -0.255094857528082 0.382631315913214 -0.380469714910186 0.257710837403586 0.118204141279823 0.203430093236919 -0.0729441296682964 0.32455037324387 -0.245674479972944 0.46836246419368 0.348182164216959 -0.0833155487819067 0.484363925557369 0.202692026521829 -0.357469677990013 -0.48508172328487 -0.139242772183225 0.013900235053984 0.322301171890167 -0.392041519843514 0.0543614057602383 0.438332723039998 0.011899914310961 -0.164031506037028 -0.266589232283699 0.117462532280389 0.293405959329215 -0.428020886643081 0.382403082123836 -0.390625051970671 0.20934960409876 0.114572157562734 -0.250396566630369 -0.47320481879167 0.142049102128565 0.110795426826145 0.0312172658684268 -0.283331994126201 -0.153565240237143))
; phi = 0.77
;(define xx #(0.339972898841982 -0.184718262296517 0.396724355842249 -0.247434268118932 -0.0794197738651222 0.475446193341507 0.0649167006427627 -0.317968474273221 -0.162919088405153 -0.265229391387416 0.275710311683356 0.442473924527503 -0.408461352855486 0.495468148810107 -0.0374065986324878 -0.457142634946331 -0.343736515772529 0.246972870153238 0.249343050846219 -0.353150596789278 0.26806294253727 0.0886806011987309 0.232387982854059 0.216498665970847 -0.371133581536239 0.13593060994701 0.280826330217521 -0.331616057457019 -0.0556850998364341 -0.42769496486315 0.458571675102652 0.0383790918864824 0.41742622785464 -0.474409958596386 0.0872027618029397 0.136757637801706 0.164000067950622 -0.174848638048979 -0.264139294342312 0.183604285222414 -0.0598399025884602 -0.402178446837618 -0.334799224838629 -0.361476849538836 -0.0076887129287847 -0.0967007445421374 0.0157169003761711 0.356007207613788 -0.249914172185527 -0.290658013345956 -0.415741207707406 0.358045582525477 0.479324704074958 0.376886655597385 -0.176394732063109 -0.0133911767619069 -0.35890019610548 0.0368801383646331 0.275761772282428 -0.142370450231316 -0.460511598122672 -0.000942860854864558 0.227920713926204 -0.292306271435283 -0.468215505572184 -0.495468148810107 0.0211946179529982 0.158639120183295 0.257678757690474 -0.0315851411196777 -0.193258172422042 0.331691813845167 -0.100855807991487 0.17612581873588 0.0937654813242413 -0.442371371483441 -0.192725704256446 0.164634233147562 0.0856501946055381 -0.123827845007558 0.1847347117459 0.463793803208078 -0.152119876348896 -0.384291575875975 -0.264353559627645 -0.0153539807805623 0.472870523839997 0.315845815672481 0.385531093311928 0.060557818992495 -0.0830604854554227 0.414591313631101 0.367034612936687 -0.124199645697016 0.376028075414673 0.13612571701098 0.0810009739555482 -0.246949324716838 0.428968282363144 -0.194315955066075))
;(define yy #(-0.385052689330444 -0.175877071296123 0.441507917271647 -0.469072286191784 0.483761425826478 0.0121413638843137 -0.28903180755677 0.46138865508539 0.214356390578849 -0.371628694483117 -0.232476027979694 -0.366623310523733 -0.252358123542878 0.433373114711855 0.3294839217968 0.253647743789843 0.365746326212334 0.46490577013917 -0.428641915801146 -0.445963464465756 0.124527855472058 0.0741678398836647 0.314057418301651 -0.0490469749890682 0.073088940145525 -0.385158652352815 0.026276564216328 -0.185425750072107 -0.419333609658788 -0.00862384810844435 0.341415547293908 0.265694998231899 0.0924477953170552 -0.442909775861886 0.351877481044042 0.253956826027988 -0.290098343810735 -0.0698062864920633 -0.112707684732227 0.0457768989630181 0.23295510574984 -0.11591762896762 -0.0432287304169153 -0.347266004659484 0.0971278919362807 0.14067951947675 -0.099094071366547 0.170155987019446 0.0174493971234147 0.130992908666735 0.477267081541583 0.350318618443458 0.177657602368684 0.00207072301376426 0.461892396629723 -0.193797469692386 0.26779179357108 -0.38404584915826 -0.128809397636245 0.0240601463152331 -0.344832604286164 0.42158003918023 0.215093040075028 -0.27634629291084 0.0936077686368581 -0.082595330865702 -0.48186089046694 0.14428637652369 -0.329872851870608 -0.311871977404595 -0.276000075034207 -0.483761425826478 -0.240333169899976 0.39558507862887 0.450713663167117 0.355940926319378 0.116149410246235 -0.479992841946577 -0.192158525139338 0.377940538218239 -0.19323783839545 -0.172882499285498 -0.442072495810459 0.172046280556047 0.238254321423643 -0.00163780479810977 -0.271518465977602 0.260709692432497 -0.0967025593827373 0.169139763192332 -0.107080987857219 0.252665972665982 -0.194076762427169 -0.347018217048123 -0.292779821250949 -0.106931754001627 -0.024591054528228 0.392310822448369 -0.464797169163015 0.308312681678869))
; from actual TEM data
;(define xx #(0.760064832795 -1.107448540205 2.105475067795 1.455659631795 0.942710358794999 -1.762060338805 -1.985725567805 0.172084220795 0.652303186795 2.055269828795 -1.213540847105 1.431428532795 0.819377340795 1.624262995795 -2.094174706635 -1.363887866705 1.026715862795 1.945150346795 1.144748242795 1.307008658795 1.487683917795 -0.112096745205001 -1.496731640505 -0.853065220205 0.907241396794999 1.658603215795 1.201263344795 0.0765991587949997 1.865224963795 1.374113683795 -0.403865037205001 1.039743105795 1.819865279795 -2.105475067795 1.210787097795 -1.974745644005 0.0624500357949995 -1.547343189505 0.656839261795 1.566946016795 -1.206153076805 -1.841840604405 1.327853514795 -1.353618965005 1.473483650795 0.725364839795 1.660787987795 0.184275341795 0.964237775795 1.149357727795 -0.960681781205001 1.311232393795 0.109391479795 1.559392566795 0.644098417795 -0.460013070205 -0.756141527205 -1.330590782905 0.781764238795 0.560526135795 0.00880002579499983 1.471805967795 1.029506083795 -0.113378175205 -1.457821724405 0.0547505027949997 0.472220879795 0.887533704795 1.207151995795 1.395001788795 0.656233097794999 -1.432645222205 0.812328089795 1.334323655795 -0.226844291205 -1.763929789405 1.213552693795 0.659618481795 0.0911301277949996 -0.0908130232050004 -1.650074974205 -0.276307165205 -2.017588262305 -1.839808975705 1.136745797795 0.0520480367949996 0.753908778795 0.213584294795 -0.329017857205001 0.582983729795 -0.110503571205 -1.608570423105 1.087748341795 -0.878714896205 0.0895136457949999 0.309139467795 0.728634874795 -0.264960172205001 0.559233046795 0.960166811795 -0.654686119205 -0.946861000205 0.413459215795 -0.0344927092050002 0.186116048795 -0.778782238205 -0.549899817205 0.822659425795 0.593330289795 0.384999459795 -0.104335421205001 -1.624458329905 -0.486338621205 0.183266337795 -1.099422855205 0.535619181795 0.718642075795 -0.276991688205001 -0.793815409205 0.367899450795 -0.0257532072050002 0.160105300795 -0.554513982205 -1.281813543105 -1.092483846205 -0.192537777205001 -0.362018815205 0.635655779795 -0.908526822205 -1.443449780805 0.315207015795 0.0215174627949994 -0.759455290205 0.501196862795 -0.547169414205001 -1.120556981205 -0.953126796205001 -0.373862407205001 0.102250120795 0.363833272795 -0.862823480205001 -0.183558104205001 0.232161004795 -0.627499758205 0.021429220795 -1.710536755005 -1.337346154605 -1.893691129405 -1.167079744105 -1.515436878705 0.141536947795 -0.386971437205 -0.175684326205001 -1.374035193905 0.00814413479499976 -0.730779366205001 -1.904244902405 -0.516560186205 -0.308311787205001 -0.891194233205 -0.110021839205001 -0.592069443205001 -1.417635744905 -1.865742914405 -1.690799478805 -0.464833039205 -0.718472787205001 -0.239727625205 -0.943574180205001 -1.545920661305))
;(define yy #(-2.2031233045 -2.1797616335 -2.2011493836 -2.185440127 -2.1080073411 -2.0787411614 -2.0424425368 -2.0227524686 -2.0099889636 -2.01441024 -1.9908226871 -1.9640852216 -1.9148429741 -1.9292625817 -1.9085516979 -1.8489351328 -1.8870628541 -1.835851773 -1.8351873622 -1.8188867093 -1.7789102596 -1.7210330737 -1.7135955767 -1.6914289746 -1.697154357 -1.6921397738 -1.6482158222 -1.6084812255 -1.6316273675 -1.5817143135 -1.5134922463 -1.4981284808 -1.4364063514 -1.4270455926 -1.4140598036 -1.3446375408 -1.3470214576 -1.2836238405 -1.2481848675 -1.2365884395 -1.2221486255 -1.1787046005 -1.1821755585 -1.0990882855 -1.0523614545 -1.0450487885 -1.0389984515 -1.0229691625 -0.9407207205 -0.8912735285 -0.9210031495 -0.8702923915 -0.8739654975 -0.8587380575 -0.8638022035 -0.8366366935 -0.8057092645 -0.7846282575 -0.7476294135 -0.6864814715 -0.6999372365 -0.6665512405 -0.6372746565 -0.5713550355 -0.5500577565 -0.5276212745 -0.5053618595 -0.4989342485 -0.5028280465 -0.4881746355 -0.4323984085 -0.3449146685 -0.3252420075 -0.2995822895 -0.2669498135 -0.2191315735 -0.1391893435 -0.0918416324999995 -0.1168793625 -0.0827775934999999 -0.0362137505 -0.0597511085 -0.0342148725000002 -0.0103299815 0.0545881425000001 0.0776969945000001 0.1124286675 0.1054035765 0.1271174645 0.1628907935 0.2042756955 0.2056059035 0.2463504895 0.2903662275 0.3073693185 0.2979621505 0.3463610365 0.3574072495 0.3669534895 0.3788763335 0.3853469685 0.4720868215 0.5000383635 0.4963352355 0.5332809625 0.5333197105 0.5583860125 0.633413489500001 0.6182582685 0.6971989675 0.7326455625 0.7489312865 0.7530541155 0.7334917705 0.7931500755 0.8148438975 0.8276417405 0.8492104785 0.8889013845 0.8990434335 0.9120864805 0.9126136495 0.9557174025 0.9960372895 0.9912378835 1.0036498615 1.0522240995 1.0291988915 1.0459592825 1.0700421225 1.1021219095 1.1468558515 1.2018669565 1.1902256495 1.2079713035 1.1894632195 1.2566824325 1.3706100605 1.3455515985 1.3503210575 1.4321581355 1.4729206055 1.4902058675 1.5316330055 1.5156379635 1.5572136695 1.5702847365 1.5857186205 1.6079599255 1.6557873495 1.6520769825 1.6695010595 1.7191169885 1.7761845635 1.7921562595 1.8343787345 1.8234303865 1.8124159865 1.9063886505 1.9420691785 1.9573074925 1.9659695515 1.9915493845 2.0241658745 2.0594973335 2.0682035635 2.1389401085 2.1309844065 2.1255125035 2.2031233045))
;(define rr #(0.106134591606735 0.104510152441772 0.100248760857013 0.0954849449740471 0.109068202739637 0.105211734993789 0.0966868446470479 0.0950989280076085 0.10736069536759 0.090376027805487 0.103192191098899 0.0982839220825727 0.0977165338052504 0.101140784686014 0.077482518060125 0.107647160821761 0.0741425305589283 0.0997097161193854 0.0794772603554507 0.0862991216737774 0.0903854927608457 0.0937946523822202 0.0932825092719431 0.099167741330874 0.106665227681151 0.0996839746028583 0.0963678037760988 0.115335297689226 0.094945883769338 0.0934748917734093 0.102284605086645 0.101411079575826 0.0873533311984367 0.0602538402743124 0.0927306457656475 0.0983709221165587 0.0698900093161181 0.0941405913245589 0.106368075912726 0.0917662208392484 0.0992367276048374 0.117539356173411 0.0982578070543567 0.0927398703937721 0.0985273286009545 0.0853923105179852 0.0882302968429187 0.0844352497491001 0.110695304790086 0.10888765860561 0.10081038295199 0.0911113408804453 0.0922682381444812 0.100878245900573 0.0950539405765583 0.11019184244557 0.0938584737827562 0.0961812078768418 0.088201205140222 0.0866848511427525 0.0783935273217979 0.0931448499321186 0.0956818398089046 0.0970401043048741 0.095422211415215 0.0967752804487345 0.103614111477837 0.0962701081850446 0.0968106321560602 0.0946932716904079 0.0886365781704557 0.101630164841839 0.0904233426221492 0.0897586655475536 0.0878805607504632 0.111365607869354 0.0933100167660053 0.10545537499241 0.0851816754919718 0.101368893511127 0.109857514686292 0.0863585768020149 0.0950089318436296 0.0905840281419314 0.101402643757507 0.0935480762705308 0.0888101297879116 0.0719407119561907 0.0965008656532259 0.0909045470883032 0.100385200189567 0.10099689630601 0.0864080915164605 0.101427949091939 0.10669730261639 0.0915235267134787 0.103275056451708 0.11273978992343 0.0884046460373257 0.0955923924331222 0.0867341795759064 0.103042865564756 0.10291826211418 0.101495399101947 0.101411079575826 0.0906501099819798 0.0816539587209259 0.10528488618415 0.090404419663533 0.0896251386064421 0.102851745204218 0.0969960172091433 0.089739602431787 0.0841510918460698 0.0972338500524427 0.0913551300086342 0.103976745488507 0.0881332871443061 0.0902718479218725 0.0965806147910187 0.0995723511909426 0.0909986025312558 0.10029141808964 0.0919245590175626 0.0969783767557183 0.0867933366998455 0.110323739081872 0.0962701081850446 0.0869213723224825 0.100708502801579 0.0762920345249501 0.092231145395387 0.109537786725909 0.104877844982462 0.107726599366707 0.0967664405121506 0.0883175144723783 0.124604968253573 0.103067768175111 0.100487408124057 0.0985012780894508 0.100844320134808 0.0889833428959656 0.117495680193171 0.0902907986469771 0.092231145395387 0.0884336708328337 0.0965540390693684 0.0963855559764588 0.0953773764700286 0.0859912819276243 0.089634682851822 0.0987874557604709 0.104206855550338 0.104616507465759 0.115238835550124 0.103192191098899 0.0799601483138381 0.117655746211462 0.0783826143313288 0.095215795865551 0.0872847534757363 0.100767945408559 0.0933924906534856 0.0904706326938582 0.0759999420400728 0.107575615970335 0.109943137156065 0.0938767005017258 0.0945124211264092))
; pressure 2
; (define xx #(0.0518559786044522 -0.21374115432038 -0.176927672808685 0.0344010001791799 -0.0736964333689679 0.0693751692665368 -0.449759332057 -0.234813010177762 -0.0283528251879012 -0.107945867394043 -0.250829336946648 0.170271910999755 0.0741495802659084 -0.439206345251962 0.329896146447174 0.111421936905215 0.345953625764747 0.204834727641529 -0.483341590038038 -0.455243514935123 -0.0403801676187299 0.050294275752084 -0.305664771090435 -0.258130670099749 0.191706240042984 0.0270567483755766 -0.00354262238442948 -0.354368735878705 -0.171376831183894 0.178597097423082 0.351255922105524 0.14181694066061 -0.484722898660908 0.100192432584035 -0.237730747767828 -0.137096443858692 0.473511880905736 0.198831627302251 0.390629929921997 -0.378224732125204 -0.0978487767220051 0.119473120526141 0.201513839514857 0.398134193439781 -0.157944028860524 -0.151708961400367 -0.402576561161519 0.348304511887599 -0.320030459343969 -0.317964535093835 -0.135507486628298 -0.342817819992899 0.273290273703068 -0.0823832324661385 0.149407601012085 0.417500800904912 0.128174959858639 0.249272971060928 0.120851066675671 -0.0106036567337709 0.249656619534004 -0.415418253475206 -0.173088715866204 0.193444855069317 0.475552513543048 0.454827675611106 0.476142777330759 -0.417302669624822 -0.232823145112121 -0.371515094536624 -0.170943544672179 0.333663652753372 -0.0651126690229091 0.121590305552404 -0.351365879747563 0.253947239750096 -0.299121407145989 0.353965636926157 0.0163985590434558 -0.0242908319211411 0.0931384990566893 0.484171735594597 0.267421257163689 -0.482199004581929 0.150666307158436 0.242337080914356 -0.311902301381648 -0.0213910825716503 -0.0994032215651335 -0.399227482964635 -0.426457228572761 -0.115994584626556 0.421959019255306 0.313323661548044 -0.242828119351223 0.362463700963361 -0.287236378396407 -0.172470759202443 0.484722898660908 0.20472274952772))
; (define yy #(0.0775672922780577 0.142394278541718 0.0782023496251403 -0.40244516535685 -0.483518077203394 0.340926653957391 0.35093968332455 0.0331706727855723 0.129006336164153 -0.412075608997617 -0.0685257848130322 -0.260007621015832 -0.306038759464544 -0.236996129371794 0.456016405918172 0.47110578240067 0.170844553078284 -0.325867695651283 -0.35539245822589 0.231264256366179 0.318381594235789 -0.169071565784967 -0.242548438178005 -0.408845593166202 0.377629772389425 0.225493155781389 -0.1248980167309 -0.384407661097045 -0.0118106524456871 0.449111650104617 -0.146763237180807 0.166266590356079 0.450649472979618 -0.244300891554203 0.48439089815958 -0.325130060681366 0.0423995463636866 -0.196612334507445 -0.259191261822712 0.353873822545854 0.0565444365143186 0.289880010854843 -0.115036371928108 0.0126029486895531 -0.464246015999598 0.303971272796655 0.142056178556432 -0.397730175398651 0.276375842538985 0.205444975815437 0.185505090838632 -0.0640117726108939 0.000925217523862265 -0.109143889370747 -0.472876009957405 0.130295331012363 -0.0939216215295824 0.305475185046191 0.101745247339765 -0.455671360603869 0.473024214576782 -0.342890576689682 -0.394916159475082 0.000512391601667828 -0.469543031301561 0.411466843698646 0.345730280284108 -0.0190300276764195 0.33590963109592 -0.48439089815958 -0.0919942148813644 -0.0478715829210827 -0.351982772737896 -0.176197749372657 -0.31016120117393 -0.436732207706851 -0.175286290080085 0.260465128577079 0.39851480292461 0.455911305583408 0.0239032567200269 -0.0678455810024863 -0.350980903017823 0.142744462039773 -0.384778755165465 0.0696982682675021 0.373410168745861 0.0144573402290461 -0.250002344139029 -0.144269526234627 -0.418105753927121 0.373637827966249 -0.367627050029398 -0.22666643836978 -0.294767927713902 0.353721236581183 0.144057787058489 0.45382131337931 -0.169751805860707 0.196410275629956))
; pressure 4
(define xx #(-0.412853359525165 -0.366995486054022 0.411049243181321 -0.244200141906658 0.433143294560511 0.261309745964321 -0.292650400290792 -0.212819671326066 -0.199319013107479 0.127744422197873 -0.131199221328975 0.075294982974932 0.323802926026089 -0.435403974366241 0.0573820422332009 0.416930492399945 0.330126874880211 0.418705248845652 -0.0942878461518095 -0.411830964538009 -0.21903018469239 -0.0386941422319938 0.28694190887313 -0.394909979332182 0.324709966493964 -0.370932839788204 -0.136976453147808 -0.312146085707475 -0.388372484651402 -0.00314944332657113 0.235445889918162 0.401424485990284 0.168496096462599 -0.0542737120878133 0.491681279099692 0.328600873142637 -0.0209617328168623 -0.305980552570411 -0.386283942984451 -0.153981278638005 0.241911824201397 -0.311007760730917 0.161630519585191 0.255899235257119 -0.200472065303031 -0.49412212204123 -0.150484655164677 -0.284620659488642 0.276006679456424 0.229857537852791 0.432932811699216 0.49412212204123 -0.4535386642612 0.155801057592991 0.138027454550668 -0.293719699079692 0.190964949315911 0.157812228537668 -0.194454206029756 -0.0569627844723583 0.410104805751487 -0.136997887596278 -0.0382522372296367 0.0170333050249484 -0.0725478537459235 0.247747550957811 0.0110315474847043 0.0748762318470312 -0.328270362781992 -0.209010881804389 0.0208860216612536 0.122576144190031 0.342241806710174 -0.118279724401205 0.166438336386827 -0.347026988794311 0.0313321717369533 -0.268273585669235 -0.103754548194182 0.445486821687189 -0.299210550148633 0.363991949282897 -0.492271171221776 0.339338258612909 0.251390276768566 0.0770376334829062 -0.142304732326042 -0.470295725669663 0.208524681237129 0.434716932234442 -0.487032286292815 0.126436791212908 -0.0110092110110543 0.0649900380983204 -0.395648009923454 0.0051521277990822 0.323463747860705 -0.459520867584729 0.0598584580388848 -0.102906870948684))
(define yy #(-0.15419750654617 0.0791308965119263 -0.173859149605544 -0.480378962403349 0.0421078183793341 -0.351905930734978 0.119369922172458 0.042528754108364 -0.270191739575757 0.493892672297404 0.385465337487702 -0.401425439712756 -0.254025116262751 -0.441257198241478 -0.0239637444320669 -0.358068414921286 -0.410135319668326 -0.272847088169908 -0.255011879236452 -0.253118355111625 0.193673933272057 -0.00260718622332956 0.144696018551216 0.00201467129244659 0.312964512960894 -0.34724914208533 0.193622716251347 -0.199102314327231 0.16648572624477 -0.093605848738278 0.448388787946598 0.160994565655783 -0.316562640507243 -0.175885883254212 0.172359723657781 -0.493892672297404 0.322712305065729 0.328962233743724 0.263283484862319 -0.419845922927862 0.356641555717988 0.212630605567424 0.395936406411801 -0.449399534808367 -0.184247872691742 -0.13017190659486 0.47356717626398 0.432200559045722 0.0612790082313586 0.204682050877211 -0.0864828395019221 0.488434140808453 0.358063300450721 -0.427095851013611 -0.23127829763531 -0.388472011706626 0.111663506937917 -0.0942421223815474 0.330575697092201 0.111609006187661 0.484455422615139 -0.121797048718388 0.241641238554152 0.440418018257563 -0.447629173809161 -0.218729810290379 -0.472019065278 -0.175941688047672 -0.484434859503982 -0.0421075646687726 0.0707729878439456 0.194652734994256 0.228245996325073 0.0205868707940657 0.265375300831334 -0.0690865561210724 0.171020836332001 -0.109255798230587 -0.342291026212677 0.246600324477957 -0.286634258339929 0.414463565648986 -0.0320693762724592 -0.0549260387377591 -0.0763052560607504 -0.316517703668002 0.102454347321762 0.259951549151108 0.000779138183330197 0.335441559913048 -0.300382901895126 0.0247619927333676 -0.374133509310235 0.258017032268099 0.444763273538309 -0.247418831402322 -0.167344671329699 0.0792795449141843 0.359406927055753 0.307667982259349))
; pressure 6
; (define xx #(-0.469015035728519 -0.326078465764082 -0.376719668056173 0.17599004829174 0.149904168255174 -0.201910682259123 -0.264512266387495 0.290451219452329 -0.184369547490537 -0.388871285951577 0.490529464101227 0.15670375778991 -0.0500971488290573 0.460770701520208 0.112886012399024 0.160085468126462 0.0333788299175646 0.177815823204526 -0.0837087832889664 0.0276741483919384 0.398288722055844 -0.0954200500449176 0.441690119511007 0.441993925347484 0.240560866528849 0.210509971510655 0.41385083206447 -0.0520063843412557 -0.343662492793928 -0.173087974968636 0.336280923458786 0.324728831308959 0.279399612102196 0.319672387763874 -0.292079378491378 -0.261597597806474 0.470094917946011 -0.419626327841283 0.13812732557052 0.426144621996863 -0.239177540298834 0.135450110822365 -0.462079967001562 0.0565532798831778 0.404244565272042 -0.15377583343655 -0.274799004751288 0.43678854459963 0.0832420797344113 -0.403450071347193 -0.490529464101227 -0.0349127073087566 0.392020516373528 0.0493952968597512 -0.162824210495082 0.246445745068231 0.0808718923558311 -0.314221490437302 0.488414510719567 0.00809711954777931 -0.174815013007078 -0.381923117185299 -0.11198294336369 -0.235015382828573 0.338217026636548 -0.335857041268417 -0.349326239328337 0.248613984198388 0.262865852681569 -0.0702461964842733 0.364223528663967 -0.47240591055972 0.0534213491677933 -0.250749370816916 -0.00183388605447954 0.268755898981607 0.239024866300201 0.0538537107836207 -0.119993649799537 -0.0297618759389584 0.207357369461365 -0.477502973889404 -0.185680906193448 0.119156836207503 0.172878114175889 0.31573701944917 -0.167345718060651 -0.469358146915318 0.343870884289513 0.0790963998921806 -0.1455647529399 -0.0666764570577156 -0.0197616676518941 -0.390417573870081 0.360003562803186 -0.278664396978779 -0.113065152943324 -0.430779036965313 -0.375589945833054 -0.276885986444958))
; (define yy #(0.0974751020296689 0.336451032033549 0.49797223429887 0.406895957435505 -0.18036412643168 -0.252765705569517 0.435967663755964 -0.288256837078209 -0.0895600716871747 -0.0307664678560444 -0.422486767393317 -0.0546314719148551 -0.337993129977698 0.29104836269338 -0.265967647786414 0.25115006259356 0.287189616438091 0.045092917092551 0.177960579640344 -0.216413054631358 0.361924798488852 -0.0573394327082324 -0.0790670401155744 -0.201116678249411 -0.391485830688215 0.323716540980307 0.192614340999446 -0.136979183417898 -0.384357774613266 -0.466059605998026 0.298950766805309 -0.0673223357227489 0.384715602547265 0.160178688651967 -0.0579473780097278 0.0251918852130995 -0.333221196590069 0.318214822274194 -0.352655179422022 0.463196855430937 -0.388185450034825 -0.49797223429887 -0.208035809538325 -0.124560929602504 -0.450980933837599 -0.175550982510681 -0.153581232151262 0.0313254789494148 0.102553976890813 0.164696808569237 0.200355092124087 -0.425957046966864 -0.277672803137882 -0.332150027263421 0.00782276901588713 -0.0256628101671552 0.00365049614048191 0.165061920318832 0.393640416059606 -0.050549688296844 0.445228346139536 -0.250612307890739 0.0911744994441598 0.329995848976754 0.455417255434657 0.0748771486411842 0.249379550359981 -0.118086362049921 0.235604303931754 0.267350370399008 -0.146030405744874 -0.120328560204922 -0.431524261641299 0.226239974407325 0.140192359060539 0.0703359663980763 0.482456559488239 0.443592089172443 0.344973579355372 0.0429056189504078 -0.248853265690047 -0.009837270264417 0.16643949149598 0.335456047011066 0.133736651344145 -0.450341346647629 0.263869448917043 0.483033835222088 0.0200764636995396 0.199939757730717 -0.382128238454793 0.460100160985157 0.366097214887245 0.407419059963883 -0.371229498847451 -0.30069764134789 -0.276396431575799 -0.35535950341531 -0.119957309936671 -0.47003790586612))
; pressure 8
; (define xx #(0.16927726251312 -0.236116249567979 0.459712596193591 0.409038942710214 -0.268251612223743 -0.110762518188111 0.0520378565013289 -0.190956004220586 -0.435510368054096 0.237941869748068 -0.341042437928051 0.111324204047776 0.38365748198504 -0.123536108331853 0.227709274811637 0.0098806351805189 -0.0205587130379262 0.0410337830319599 0.374869684205421 0.133883236802335 -0.166961706081772 0.432819773678355 -0.352956165853425 -0.273897891853728 -0.441220610428119 0.258498596428788 -0.0876250226424721 0.0499498880394251 -0.0743216234465918 -0.18124974885145 0.248858399443307 0.340576893834026 0.0839840538505897 0.479765397297579 -0.0799519377481179 -0.350055076892655 0.471269947754484 -0.220336942885042 -0.0236333366577841 -0.0729450191026906 0.381932987181829 0.414591864725149 -0.206987033971042 -0.289688807844111 0.139219690390278 -0.0664069348210498 -0.40117317548136 0.16543913905438 0.0241508215937161 0.172113234301006 -0.024912756956508 0.323585882149086 -0.0844003303919121 -0.189419038394273 -0.0318265905268847 -0.440184338593238 -0.378488518227646 0.436977746799465 0.291707561657298 0.118613461724755 -0.0156061956598638 0.00727579200161144 -0.486923792484751 0.219307361321445 0.297940557770235 -0.262468324553239 0.331464997679074 0.201522432498826 -0.106673187783589 -0.456366731811798 -0.184200177754959 0.410264703279942 -0.38395464920094 0.206474438578126 -0.474384719189928 -0.282601772006931 -0.372951479303316 0.396867723838631 0.323474729384806 0.131896728503057 -0.255628518683792 -0.327946115949074 -0.128338880520733 0.227404528364366 0.147886323663004 0.077154798777486 0.229407060060382 -0.441303912973321 -0.1558967419417 0.486923792484751 -0.310137321688481 0.304677248730572 -0.186962901109653 0.0614234261538508 -0.480886503141167 0.386948840888832 -0.269676794453519 -0.401770910196682 -0.342045850208455 0.303726903056716))
; (define yy #(0.0945167121760143 0.122131986041865 -0.216682522746469 -0.059583353501226 -0.407987509484146 -0.396349982868064 0.367586015552222 -0.0508793079394457 -0.489033399555432 0.456610406701845 -0.46434473364246 0.0172152435340633 -0.163774529565577 0.123464001040308 0.267565199231504 0.458892835182501 -0.330222954420277 -0.0752878080801733 0.474473504885285 -0.0922421300184457 0.211430871934525 0.0471756263718666 0.434265478542375 0.033369179858349 0.400512713291265 0.151216150355212 0.0318076058665494 0.223783543047679 0.372518553663587 0.0408174890304569 0.045550063154349 0.288395985043865 -0.426329872921697 0.306271375232588 -0.0626571225192366 -0.156074578263253 0.451897352548447 -0.143675152582544 -0.429814509336916 -0.241995153310106 -0.276965282800084 0.233463023770337 0.300567125283361 -0.0736874770014301 0.423481879631953 0.196176218705697 -0.0734043592613264 -0.478040174869992 -0.249110432988944 0.192664377797348 -0.16008874853143 -0.0146244476044466 0.489033399555432 -0.475284305248446 0.109588218472033 -0.376399381227603 0.195283537595902 -0.455060378352879 -0.321227261433308 -0.253033252194912 0.296775501880107 0.013920878874933 -0.0161184289030025 -0.262541674537648 0.379261998551104 0.212425227488363 0.0898050752219853 -0.163067837159616 0.28272549893542 0.100721577740453 -0.239247594730722 0.140930593398062 0.0169847826979841 0.360648356018841 -0.290930781876332 -0.227504140396488 -0.256045265772938 0.380799377166547 -0.441938613698356 0.286430606595535 0.380368842248878 0.11499237344805 -0.153373224127855 -0.409295889184139 -0.352594234064479 -0.170344716996108 -0.0542249889587592 -0.171559122382678 0.430205630539222 -0.109887462199996 0.306243190469438 -0.107466924530376 -0.33582949167378 0.105157557314569 0.210035079604465 -0.369943779826258 0.476442380712144 0.28702058828143 -0.347982733068388 -0.212650685962685))
; pressure 10
; (define xx #(0.253721589796731 0.443974845113779 -0.266449971198885 0.477916041442686 -0.208718040399147 -0.142755307373942 0.0636758409610534 0.0774862935737269 0.251136477889075 0.457423444282046 0.327863305558317 0.177811665501811 -0.227411269256647 0.267901731938199 -0.132548819525556 -0.11708183847462 -0.310342101482179 -0.388826446190251 -0.0342894820632622 -0.173697367223243 0.139237340015071 -0.00403292606636402 0.246358595974482 0.0541623013364146 -0.114840226839771 0.261457866683275 0.168877550151261 0.160489544165094 -0.427913995990883 -0.199042761063009 -0.307458533255085 -0.491742652632552 0.0768490610706698 0.104651698099888 0.335865713615314 0.317680926079999 -0.013677125272143 0.322186296130776 0.435718957967058 0.430493964557745 -0.409519229987815 -0.401285926315152 0.377840548704562 -0.191359023188754 0.422329124076288 -0.38316479925014 -0.476520992725468 0.339876410256242 -0.208662442955124 0.377545502368018 -0.320695857812707 0.0645477818659254 0.167106325136336 0.243104393028097 -0.289898096445386 0.412878665897684 -0.22078165664232 -0.371125170466986 -0.473475253113796 -0.135626028490094 -0.0767799427948529 -0.213042141968185 -0.334951734971767 -0.256952232167995 -0.382889552863091 0.00679275256468759 0.343128362980161 -0.0131180864139649 0.222729130220604 0.166712723849441 -0.0221568105153338 -0.113372433532146 -0.0809814278403544 0.235316856836267 -0.105895594354096 -0.290544128292419 0.412416103223266 0.0424889599663919 0.159864929810552 0.492837435877535 -0.476189236003723 -0.0370436593667459 0.0810720260397785 0.246320270273189 -0.115343210242869 0.341484481726023 -0.480893282914931 -0.410057235150348 -0.469919704265876 -0.032090438881681 -0.313636829498153 -0.398336369980463 0.351652821491013 0.0167419939034449 0.133043823223961 -0.492837435877535 0.14760767052164 -0.352544294735124 -0.294617092597644 0.0861306503168918))
; (define yy #(0.39369500744872 0.0334627508661646 0.0701738479887097 0.378931458400354 -0.116458874695776 -0.0185502000424823 -0.380816136862156 0.0313306833158248 -0.164030255953142 -0.345377897476196 -0.329222917496771 -0.346305912751637 -0.260151216950781 -0.410446710286413 -0.303247896124841 0.374747678696605 -0.332756813936117 0.493426772452769 0.327782804417624 0.0928620709151918 0.438308258201203 -0.12147355304954 -0.0677967848847918 0.392832136782016 0.497111121601517 0.0524763256397672 -0.223743616828145 -0.0213172533210317 -0.381063839298182 0.426311734745534 0.3717728444187 -0.259105531951453 -0.0685444989859088 0.158236279155036 -0.231259322416184 -0.497111121601517 -0.0198415849496545 0.310804901210087 0.142016029098983 -0.0613125684207456 -0.191090073587067 -0.0837414562045813 -0.415743954824172 0.19198432842894 -0.191176805166338 0.308142540440981 0.284045423154082 0.215511986840279 -0.474197959735315 0.394423063415727 -0.232176497393885 0.297532521040433 0.082690345662614 0.251611957212051 0.165778020422615 0.490246531607909 -0.37749528855693 0.108577737445668 -0.0164237222223509 0.272925908070916 0.05134571141916 0.331670120902357 -0.425917865053902 -0.0273579208618382 0.20521983388182 0.0997923683524279 -0.135553771820629 -0.221037921633353 0.489360594593221 0.345531996337723 -0.433299052963269 -0.208093701845813 0.155236054845395 0.149320499732254 -0.106583878141155 0.266635232673949 0.278295850769021 0.490526198069032 -0.118165628974 -0.438982838447867 0.18095962933506 0.427579921247562 -0.174480557552778 -0.279592309109691 -0.407431132415496 0.118089638271627 0.467491053065262 0.399824007064792 0.0836522767459794 -0.330422153663555 -0.128133351337596 -0.290667436007448 -0.00455123512742545 0.205293708645489 -0.46617333991412 -0.132141095741476 0.249158154191637 0.010699851117846 0.477137798951156 -0.288186533230769))

; source properties
(define fcen 3.4)
(define df 4)
(define nfreq 100)

; geometry

(define sx mag) ; width of original image
(define sy0 mag) ; height of original image
(define sy (+ pad cor sy0 (* 2 dpml)))
(set! geometry-lattice (make lattice (size sx sy no-size)))

; material properties

(define-param n1 1) ; refractive index of matrix
(define-param n2 2) ; RI of rods
(define eps1 (* n1 n1)) ; permittivity of material 1 (low index)
(define eps2 (* n2 n2)) ; permittivity of material 2 (high index)
(define-param k1 0)	; extinction coeff mat 1
(define-param k2 0.01)	; extinction coeff mat 2
(define mat1 (make medium (epsilon eps1) (D-conductivity (/ (* 2 pi fcen (* 2 (sqrt eps1) k1)) eps1))))
(define mat2 (make medium (epsilon eps2) (D-conductivity (/ (* 2 pi fcen (* 2 (sqrt eps2) k2)) eps2))))
(set! default-material mat1)

; loop to place rods at specified locations

(define (doit x x-max dx)
	(if (<= x x-max)
 	  (begin
  		(set! geometry (append geometry
  			(list 
  			 ;(make block
  	  	 	;	(center 0 (- (* 0.5 sy) (/ (+ dpml pad cor) 2)))
  	  	   ;		(size sx (+ dpml pad cor) infinity) 
  	  	   	;		(material mat1))
  			 (make cylinder
  				 (center 
  						  (* (vector-ref xx x) mag) 
  						  (+ (* (vector-ref yy x) mag) (+ (* -0.5 sy) dpml (/ sy0 2))))
  				 	(radius r) (height infinity)
    				  (material mat2)))))
  	   (doit (+ x dx) x-max dx))))

; define geometry
(if no-struc?
	(set! geometry (list 
		(make block (center 0 0) (size sx sy infinity) (material mat1))))
	(doit 0 99 1)) ; do loop from a to b in steps of dx

; excite sources

(set! sources (list
	 (make source
	  (src (make gaussian-src (frequency fcen) (fwidth df)))
	    (component Hz)
		(center 0 (- (* 0.5 sy) dpml 1))
		(size sx 0))))

; boundary conditions, etc.

;(set! pml-layers (list (make pml (thickness 1.0))))
(set! pml-layers (list (make pml (direction Y) (thickness dpml)))) ; only on Y extremes
(set! ensure-periodicity true)
(set! k-point (vector3 0 0 0))
(define-param res 50)
(set! resolution res)

; define flux regions (planes)

(define refl ; reflected flux
	(add-flux fcen df nfreq
	 (make flux-region
	  (center 0 (- (* 0.5 sy) dpml 2)) (size (* sx 2) 0))))
(define trans ; transmitted flux
	(add-flux fcen df nfreq
	 (make flux-region
	 (center 0 (+ (* -0.5 sy) dpml 1)) (size (* sx 2) 0)))) ; changed from (* sy2)
(if (not no-struc?) (load-minus-flux "refl-flux" refl))

; run

; (run-until 20
; 	(at-beginning output-epsilon)
; 	 (at-every 0.6 (output-png Hz "-Zc bluered -C $EPS")))

(run-sources+
	(stop-when-fields-decayed 50 Hz
		(vector3 0 (- (* 0.5 sy) dpml 1))
		1e-2)
	(at-beginning output-epsilon)
	(at-end (output-png Hz "-Zc bluered")))

; output

(if no-struc? (save-flux "refl-flux" refl))
(display-fluxes trans refl) ; print out the flux spectrum